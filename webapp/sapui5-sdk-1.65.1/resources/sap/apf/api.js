/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/ui/instance','sap/apf/core/instance','sap/apf/core/messageHandler','sap/apf/core/messageDefinition','sap/apf/core/constants','sap/apf/core/utils/filterSimplify','sap/ui/thirdparty/datajs','sap/apf/utils/utils','sap/apf/utils/filter','sap/apf/utils/externalContext','sap/apf/utils/startFilterHandler','sap/apf/utils/startFilter','sap/apf/utils/filterIdHandler','sap/apf/utils/serializationMediator','sap/apf/utils/navigationHandler','sap/apf/utils/startParameter','sap/apf/messageCallbackForStartup','sap/apf/ui/representations/RepresentationInterfaceProxy'],function(U,C,M,a,b,F,D,c,d,E,S,f,g,h,N,i,j,R){'use strict';function A(o,k,m){var l;var n;var s;var p;var q;var r;var t;var u;var v;var w;var x;var y;var z;var B=true;var G=jQuery.Deferred();var H=new jQuery.Deferred();var I;var J;this.type='api';this.constants={};this.constants.eventTypes=b.eventTypes;this.destroy=function(){l.activateOnErrorHandling(false);l.setMessageCallback(undefined);l.setLifeTimePhaseShutdown();if(y&&y.destroy){y.destroy();}if(n){n.destroy();}y=undefined;n=undefined;l=undefined;s=undefined;p=undefined;};this.activateOnErrorHandling=function(e){return n.activateOnErrorHandling(e);};this.getStartParameterFacade=function(){return n.getStartParameterFacade();};this.getLogMessages=function(){return n.getLogMessages();};this.createStep=function(e,O,P){return n.createStep(e,O,P);};this.getActiveStep=function(){return n.getActiveStep();};this.getCategories=function(){return n.getCategories();};this.getSteps=function(){return n.getSteps();};this.getStepTemplates=function(){return n.getStepTemplates();};this.getFacetFilterConfigurations=function(){return n.getFacetFilterConfigurations();};this.getApplicationConfigProperties=function(){return n.getApplicationConfigProperties();};this.moveStepToPosition=function(e,O,P){return n.moveStepToPosition(e,O,P);};this.removeStep=function(e,O){return n.removeStep(e,O);};this.resetPath=function(){return n.resetPath();};this.setActiveStep=function(e){return n.setActiveStep(e);};this.stepIsActive=function(e){return n.stepIsActive(e);};this.updatePath=function(e){return n.updatePath(e);};this.getApfLocation=function(){return n.getUriGenerator().getApfLocation();};this.readPaths=function(e){return n.readPaths(e);};this.savePath=function(P,e,O){n.savePath(P,e,O);};this.openPath=function(P,e,O){return n.openPath(P,e,O);};this.deletePath=function(P,e){return n.deletePath(P,e);};this.addFacetFilter=function(e){y.getLayoutView().getController().addFacetFilter(e);};this.getEventCallback=function(e){return y.getEventCallback(e);};this.putMessage=function(e){return n.putMessage(e);};this.createMessageObject=function(e){return n.createMessageObject(e);};this.getTextHtmlEncoded=function(e,P){return n.getTextHtmlEncoded(e,P);};this.getTextNotHtmlEncoded=function(e,P){return n.getTextNotHtmlEncoded(e,P);};if(!m){this.loadApplicationConfig=function(e){n.loadApplicationConfig(e);};}else{this.loadApplicationConfig=function(e){};}this.createFilter=function(){return n.createFilter();};this.addPathFilter=function(e){return t.add(e);};this.updatePathFilter=function(e,O){t.update(e,O);};this.getPathFilter=function(e){return t.get(e);};this.createReadRequest=function(e){return n.createReadRequest(e);};this.createReadRequestByRequiredFilter=function(e){return n.createReadRequestByRequiredFilter(e);};this.selectionChanged=function(e){y.selectionChanged(e);};this.createApplicationLayout=function(){if(!I){I=new sap.m.App().addStyleClass("sapApf");}return I;};this.startApf=function(){var O;var P=this;var Q=this.createApplicationLayout();H.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(o,[this]);}G.resolve();y.createApplicationLayout(Q).then(function(){O=p.checkMode();var T=y.handleStartup(O);T.done(function(){if(P.fnAfterApfStartupCallback&&typeof P.fnAfterApfStartupCallback==="function"){P.fnAfterApfStartupCallback.apply(o,[P]);}l.setLifeTimePhaseRunning();});});}catch(e){B=false;}}.bind(this));return Q;};this.addMasterFooterContent=function(e){return y.addMasterFooterContentRight(e);};this.setEventCallback=function(e,O){switch(e){case b.eventTypes.contextChanged:y.setEventCallback(e,O);return true;case b.eventTypes.printTriggered:y.setEventCallback(e,O);return true;case b.eventTypes.format:this.customFormat(O);return true;default:return false;}};this.customFormat=function(e){y.setCustomFormatExit(e);};this.setCallbackBeforeApfStartup=function(e){this.fnBeforeApfStartupCallback=e;};this.setCallbackAfterApfStartup=function(e){this.fnAfterApfStartupCallback=e;};this.getPropertyValuesOfExternalContext=function(e){var O=jQuery.Deferred();r.getCombinedContext().then(function(P){var Q=P.getFilterTermsForProperty(e);var T=[];Q.forEach(function(V){var W={Low:V.getValue(),Option:V.getOp(),High:V.getHighValue()};T.push(W);});O.resolve(T);});return O.promise();};this.startupSucceeded=function(){return B;};if(o&&o.getInjections instanceof Function){if(!k){k={};}jQuery.extend(k,k,o.getInjections());}s=new(k&&k.constructors&&k.constructors.StartParameter||i)(o,m);l=new(k&&k.constructors&&k.constructors.MessageHandler||M)();l.activateOnErrorHandling(true);l.setLifeTimePhaseStartup();l.loadConfig(a,true);z=k&&k.functions&&k.functions.messageCallbackForStartup||j;l.setMessageCallback(z);if(k&&k.functions&&k.functions.isUsingCloudFoundryProxy){J=k.functions.isUsingCloudFoundryProxy;}else{J=function(){return false;};}try{n=new(k&&k.constructors&&k.constructors.CoreInstance||C.constructor)({functions:{isUsingCloudFoundryProxy:J,getCumulativeFilter:function(){return q.getCumulativeFilter();},getCombinedContext:function(){return r.getCombinedContext();},ajax:(k&&k.functions&&k.functions.ajax),serializeApfState:function(e,O){return x.serialize(e,O);},deserializeApfState:function(e){return x.deserialize(e);},odataRequest:(k&&k.functions&&k.functions.odataRequest),getComponentName:function(){if(m&&m.manifest&&m.manifest["sap.app"]){return m.manifest["sap.app"].id;}return o.getMetadata().getComponentName();}},instances:{messageHandler:l,startParameter:s,datajs:(k&&k.instances&&k.instances.datajs)||OData,component:o},constructors:{Request:(k&&k.constructors&&k.constructors.Request),Metadata:(k&&k.constructors&&k.constructors.Metadata),MetadataFactory:(k&&k.constructors&&k.constructors.MetadataFactory),ResourcePathHandler:(k&&k.constructors&&k.constructors.ResourcePathHandler),TextResourceHandler:(k&&k.constructors&&k.constructors.TextResourceHandler),SessionHandler:(k&&k.constructors&&k.constructors.SessionHandler),Persistence:(k&&k.constructors&&k.constructors.Persistence)},manifests:m,exits:(k&&k.exits),coreProbe:(k&&k.coreProbe),corePromise:H});v={instances:{startParameter:s,component:o,messageHandler:l},functions:{getConfigurationProperties:n.getApplicationConfigProperties,ajax:n.ajax}};r=new((k&&k.constructors&&k.constructors.ExternalContext)||E)(v);u={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getReducedCombinedContext:n.getReducedCombinedContext,createRequest:n.getFunctionCreateRequest()},instances:{messageHandler:l,onBeforeApfStartupPromise:G.promise()},constructors:{StartFilter:f}};q=new((k&&k.constructors&&k.constructors.StartFilterHandler)||S)(u);w={functions:{setRestrictionByProperty:q.setRestrictionByProperty,getRestrictionByProperty:q.getRestrictionByProperty},instances:{messageHandler:l}};t=new((k&&k.constructors&&k.constructors.FilterIdHandler)||g)(w);x=new((k&&k.constructors&&k.constructors.SerializationMediator)||h)({instances:{coreApi:n,filterIdHandler:t,startFilterHandler:q,messageHandler:l}});var K={constructors:{FilterReduction:F.FilterReduction},functions:{getCumulativeFilterUpToActiveStep:n.getCumulativeFilterUpToActiveStep,getNavigationTargets:n.getNavigationTargets,getActiveStep:n.getActiveStep,createRequest:n.getFunctionCreateRequest(),getXappStateId:n.getStartParameterFacade().getXappStateId,isFilterReductionActive:n.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:n.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:l,component:o,serializationMediator:x}};p=new((k&&k.constructors&&k.constructors.NavigationHandler)||N)(K);y=new(k&&k.constructors&&k.constructors.UiInstance||U)({oCoreApi:n,oFilterIdHandler:t,oSerializationMediator:x,oNavigationHandler:p,oComponent:o,oStartParameter:s,oStartFilterHandler:q,functions:k&&k.functions||{},exits:k&&k.exits||{}});}catch(L){B=false;this.startApf=function(){return new sap.m.Text({text:""});};this.loadApplicationConfig=function(){return"";};jQuery.sap.log.error("Caught exception during creation of APF API");}if(n){n.createRepresentation=function(e,O){jQuery.sap.require(e);var P=new sap.apf.ui.representations.RepresentationInterfaceProxy(n,y);var Q=c.extractFunctionFromModulePathString(e);return new Q(P,O);};}if(k&&k.probe&&typeof k.probe==='function'){k.probe({apfApi:this,coreApi:n,component:o,uiApi:y,messageHandler:l,serializationMediator:x,navigationHandler:p,startParameter:s,injectedFunctionsNavigationHandler:K&&K.functions,startFilterHandler:q,externalContext:r,filterIdHandler:t,corePromise:H});}}sap.apf.Api=A;return A;},true);
