/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.binding");jQuery.sap.require("sap.apf.core.constants");jQuery.sap.require("sap.apf.core.utils.filter");jQuery.sap.require("sap.apf.core.utils.filterTerm");(function(){'use strict';sap.apf.core.Binding=function(I,b,f,r){var t=this;this.type="binding";var n=0;var R=[];var a=[];var c=[];var C;this.oTitle=b.oTitle;this.oLongTitle=b.oLongTitle;var d=b.requiredFilters;var o=b.requiredFilterOptions;this.destroy=function(){R.forEach(function(h){if(h&&h.destroy){h.destroy();}});R=[];a=[];c=[];C=undefined;};function e(F,h){if(I.exits&&I.exits.binding&&I.exits.binding.afterGetFilter){return I.exits.binding.afterGetFilter(F,t.getSelectedRepresentation(),I.instances.coreApi,b,h);}return F;}this.getFilter=function(h){var s=this.getSelectedRepresentation();var m=sap.apf.core.constants.filterMethodTypes;var i=[];var j;if(s.getFilterMethodType()===m.filter){var F=s.getFilter().getInternalFilter();return e(F,h);}if(s.getSelectionAsArray){i=s.getSelectionAsArray();}else{return e(new sap.apf.core.utils.Filter(I.instances.messageHandler),h);}if(i===undefined){j=sap.apf.core.utils.Filter.createEmptyFilter(I.instances.messageHandler,d);return e(j,h);}if(i.length===c.length||i.length===0){return e(new sap.apf.core.utils.Filter(I.instances.messageHandler),h);}j=sap.apf.core.utils.Filter.createFromArray(I.instances.messageHandler,d,c,i);return e(j,h);};this.getRequiredFilters=function(){return d;};this.getRequiredFilterOptions=function(){return o;};this.getRequestOptions=function(h){if(jQuery.isFunction(this.getSelectedRepresentation().getRequestOptions)){return this.getSelectedRepresentation().getRequestOptions(h);}return{};};this.setFilterValues=function(v){var h=this.getSelectedRepresentation();h.setFilterValues(v);};this.setData=function(D){I.instances.messageHandler.check(D!==undefined,"aDataResponse is undefined (binding function setData)");c=D.data;C=D.metadata;this.getSelectedRepresentation().setData(D.data,D.metadata,D.count,D.selectionValidation);};this.updateTreetable=function(h,m,i,F){this.getSelectedRepresentation().updateTreetable(h,m,i,F);};this.getSortedSelections=function(){return this.getSelectedRepresentation().getSortedSelections();};this.getRepresentationInfo=function(){var h=jQuery.extend(true,[],a);for(var i=0;i<h.length;i++){delete h[i].id;delete h[i].type;delete h[i].constructor;}return h;};this.getSelectedRepresentationInfo=function(){I.instances.messageHandler.check(n>=0&&n<a.length,"index in array boundaries");var h=jQuery.extend(true,{},a[n]);delete h.id;delete h.type;delete h.constructor;return h;};this.getSelectedRepresentation=function(){I.instances.messageHandler.check(n>=0&&n<R.length,"selectedRepresentation in array boundaries");return R[n];};this.setSelectedRepresentation=function(r){I.instances.messageHandler.check(typeof r==="string","setSelectedRepresentation() - sRepresentationId missing");var t=this;var h=this.getSelectedRepresentation();var s=j(r,b.representations);var N=k(s);n=s.index;if(c!==undefined&&C!==undefined){N.setData(c,C);}if(N.adoptSelection){N.adoptSelection(h);}if(h&&h.onChartSwitch){h.onChartSwitch();}function j(r,l){for(var i=0;i<l.length;i++){if(r===l[i].id){return{config:l[i],constructor:f.getConfigurationById(l[i].representationTypeId).constructor,index:i};}}I.instances.messageHandler.check(false,"Representation config not found");}function k(S){var i;if(R[S.index]===undefined){if(S.config.parameter&&S.config.parameter.alternateRepresentationTypeId){S.config.parameter.alternateRepresentationType=f.getConfigurationById(S.config.parameter.alternateRepresentationTypeId);}S.config.parameter.requiredFilters=b.requiredFilters;S.config.parameter.requiredFilterOptions=b.requiredFilterOptions;i=t.convertSortToOrderBy(S.config.parameter);R[S.index]=I.instances.coreApi.createRepresentation(S.constructor,i);return R[S.index];}return R[S.index];}};this.serialize=function(){return{selectedRepresentation:t.getSelectedRepresentation().serialize(),selectedRepresentationId:t.getSelectedRepresentationInfo().representationId};};this.deserialize=function(s){t.setSelectedRepresentation(s.selectedRepresentationId);t.getSelectedRepresentation().deserialize(s.selectedRepresentation);return t;};this.convertSortToOrderBy=function(p){var h;if(p.sort&&!p.orderby){h=jQuery.extend(true,{},p);if(p.alternateRepresentationType){h.alternateRepresentationType=p.alternateRepresentationType;}h.orderby=[{property:p.sort.sortField,ascending:!p.sort.descending}];delete h.sort;return h;}h=p;return h;};R[0]=undefined;var g=false;b.representations.forEach(function(h,i){var s=h.representationTypeId;a[i]=jQuery.extend(true,{},f.getConfigurationById(s));a[i].representationId=h.id;if(r===a[i].representationId){g=true;}a[i].representationLabel=h.label;a[i].thumbnail=h.thumbnail;a[i].parameter=jQuery.extend(true,{},h.parameter);});if(g){this.setSelectedRepresentation(r);}else if(a.length>0){this.setSelectedRepresentation(a[0].representationId);}if(!g&&r){I.instances.messageHandler.putMessage(I.instances.messageHandler.createMessageObject({code:'5037',aParameters:[r]}));}};}());
