/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/utils/filter","sap/apf/core/constants"],function(C,c){'use strict';var F=function(m){var t;var e=this;var f=function(){t=new a(m,F.topAndId);};this.getById=function(i){if(t){if(i===F.topAndId){return t;}return t.getById(i);}return undefined;};this.type="filter";this.getExpressions=function(){if(t){return t.getExpressions();}return[];};this.getInternalFilter=function(){return t.getInternalFilter();};this.getTopAnd=function(){return t;};this.updateExpression=function(i,E){m.check(i===E.id,"sId differs from oExpression.id");var o=this.getById(i);o.update(E);};this.updateValue=function(i,v,h){m.check(i!==undefined,"Filter updateValue: parameter id required");m.check(v!==undefined,"Filter updateValue: parameter value is required");var E=this.getById(i);m.check(E!==undefined,"Filter updateValue: id for expression not valid");E.updateValue(v,h);};this.serialize=function(){function g(h,T){var s={id:T.getId(),type:T.type,expressions:[],terms:[]};h.forEach(function(j,i){if(j instanceof Array){if(T.type==="filterAnd"){s.terms.push(g(j,T.getAndTerms()[i]));}else if(T.type==="filterOr"){s.terms.push(g(j,T.getOrTerms()[i]));}}else{s.expressions.push(j);}});return s;}return g(this.getTopAnd().getExpression(),this.getTopAnd());};this.deserialize=function(s){t=undefined;f();function g(s,T){if(s.type==="filterAnd"&&s.id!==F.topAndId){T=T.addAnd(s.id);}else if(s.type==="filterOr"&&s.id!==F.topAndId){T=T.addOr(s.id);}s.expressions.forEach(function(h){T.addExpression(h);});s.terms.forEach(function(h){g(h,T);});}g(s,this.getTopAnd());return this;};this.addAnd=function(i){jQuery.sap.log.error("Method 'addAnd' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.intersectWith=function(g){var i=0;var h=[];var o;var r=new F(m);var R=e.serialize();s(R);switch(arguments.length){case 1:o=arguments[0];if(o instanceof Array){h=o;}else{h.push(o);}break;default:h=Array.prototype.slice.call(arguments,0);}h.forEach(function(j){m.check((j instanceof F),"Parameter value is not of type sap.apf.utils.Filter");var I=j.serialize();s(I);Array.prototype.push.apply(R.expressions,I.expressions);Array.prototype.push.apply(R.terms,I.terms);});r.deserialize(R);return r;function s(S){if(S.id!==F.topAndId){S.id='#'+i++ +'#';}S.terms.forEach(s);}};f();return this;};F.createFilterFromSapUi5FilterJSON=function(m,s){var r=new F(m);function e(f,l,g){var h;l++;if(g.aFilters){if(g.bAnd){if(l!==1){h=f.addAnd();}else{h=f;}}else{h=f.addOr();}g.aFilters.forEach(function(i){e(h,l,i);});}else if(g.sOperator){f.addExpression({name:g.sPath,operator:g.sOperator,value:g.oValue1,high:g.oValue2});}}e(r.getTopAnd(),0,s);return r;};F.getOperators=function(){return c.FilterOperators;};F.prototype.getOperators=F.getOperators;F.topAndId='filterTopAnd';var a=function(m,I){var e=I;var A=[];var t=this;this.type="filterAnd";this.getById=function(I){if(I===e){return this;}var T;var i;for(i=0;i<A.length;i++){T=A[i].getById(I);if(T!==undefined){return T;}}return undefined;};this.getExpressions=function(){var E=[];var T;var i;for(i=0;i<A.length;i++){T=A[i].getExpression();if(T instanceof Array&&T.length===0){continue;}if(T instanceof Array){E.push(T);}else{E.push([T]);}}return E;};this.getExpression=function(){var E=[];var T;var i;for(i=0;i<A.length;i++){T=A[i].getExpression();if(T instanceof Array&&T.length===0){continue;}E.push(T);}return E;};this.getCompoundExpressions=function(){jQuery.sap.log.error("Method 'getExpressions' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getId=function(){return I;};this.getInternalFilter=function(){var f=new C(m);var l=A.length;var i;for(i=0;i<l;i++){f.addAnd(A[i].getInternalFilter());}return f;};this.addAndTerm=function(T){jQuery.sap.log.error("Method 'addAndTerm' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getAndTerms=function(){return A;};this.addOr=function(I){m.check((I===undefined||this.getById(I)===undefined),"Filter includes duplicated identifiers (IDs)");var o=new b(m,I,t);A.push(o);return o;};this.addExpression=function(E){if(E.operator.length==2){E.operator=E.operator.toUpperCase();}m.check((E.id===undefined||this.getById(E.id)===undefined),"Filter includes duplicated identifiers (IDs)");m.check((E.operator!==undefined),"sap.apf.utils.Filter oExpression.operator undefined");m.check((jQuery.inArray(E.operator,c.aSelectOpt)>-1),"Filter oExpression.operator "+E.operator+" not supported");A.push(new d(m,E));return this;};};var b=function(m,I,A){var e=I;var o=[];var f=A;this.type="filterOr";this.getById=function(I){if(I===e){return this;}var t;for(var i=0;i<o.length;i++){t=o[i].getById(I);if(t!==undefined){return t;}}return undefined;};this.getExpression=function(){var E=[];var t;for(var i=0;i<o.length;i++){t=o[i].getExpression();if(t instanceof Array&&t.length===0){continue;}E.push(t);}return E;};this.getId=function(){return I;};this.getInternalFilter=function(){var g=new C(m);for(var i=0;i<o.length;i++){g.addOr(o[i].getInternalFilter());}return g;};this.getAndObject=function(){return f;};this.addOrTerm=function(t){jQuery.sap.log.error("Method 'addOr' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getOrTerms=function(){return o;};this.addExpression=function(E){if(E.operator.length==2){E.operator=E.operator.toUpperCase();}m.check((E.id===undefined||this.getAndObject().getById(E.id)===undefined),"Filter includes duplicated identifiers (IDs)");m.check((E.operator!==undefined),"sap.apf.utils.Filter oExpression.operator undefined");m.check((jQuery.inArray(E.operator,c.aSelectOpt)>-1),"Filter oExpression.operator "+E.operator+" not supported");o.push(new d(m,E));return this;};this.addAnd=function(I){m.check((I===undefined||this.getById(I)===undefined),"Filter includes duplicated identifiers (IDs)");var g=new a(m,I);o.push(g);return g;};};var d=function(m,e){f(e.high,e.operator);var i=e.id;var n=e.name;var o=e.operator;var v=e.value;var h=e.high;this.getById=function(g){if(i===g){return this;}return undefined;};this.getExpression=function(){if(!o||o!==c.FilterOperators.BT){return{name:n,operator:o,value:v};}return{name:n,operator:o,value:v,high:h};};this.getInternalFilter=function(){return new C(m,n,o,v,h);};this.update=function(e){f(e.high,e.operator);n=e.name;o=e.operator;v=e.value;h=e.high;};this.updateValue=function(g,j){v=g;if(j!==undefined){h=j;}f(h,o);};function f(g,j){if(!j){return;}if(j===c.FilterOperators.BT&&(g===null||g===undefined)){m.check(false,"sap.apf.utils.FilterExpression: High value needed for 'between' selection");}else if(j!==c.FilterOperators.BT&&(g!==null&&g!==undefined)){m.check(false,"sap.apf.utils.FilterExpression: High value only needed for 'between' selection");}}};sap.apf=sap.apf||{};sap.apf.utils=sap.apf.utils||{};sap.apf.utils.Filter=F;return F;},true);
