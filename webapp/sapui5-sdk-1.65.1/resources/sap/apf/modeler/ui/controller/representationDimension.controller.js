/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(['sap/apf/modeler/ui/utils/constants',"sap/apf/core/constants","sap/apf/modeler/ui/controller/propertyType","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/propertyTypeOrchestration"],function(M,c,B,D,t,a){"use strict";c=c||sap.apf.core.constants;D=D||sap.apf.modeler.ui.utils.DisplayOptionsValueBuilder;var r=c.representationMetadata;return B.extend("sap.apf.modeler.ui.controller.representationDimension",{_apfName:"representationDimension",setLabelDisplayOptionTypeAsPromise:function(o){var C=this;var d=jQuery.Deferred();var l=[];var b=new D(C.oTextReader,o);var L=c.representationMetadata.labelDisplayOptions;var p=t.removePrefixText(C.byId("idPropertyType").getSelectedKey(),C.oTextReader(M.texts.NOTAVAILABLE));var s=C.oRepresentation.getLabelDisplayOption(p);var m=b.getLabelDisplayOptions();C.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){if((s===L.KEY_AND_TEXT||s===L.TEXT)&&!C.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,p)){m=b.getValidatedLabelDisplayOptions();l=t.addPrefixText([s],C.oTextReader);s=l[0];}C.byId("idLabelDisplayOptionType").setModel(m);C.byId("idLabelDisplayOptionType").setSelectedKey(s);d.resolve();});return d.promise();},getAllPropertiesAsPromise:function(){var C=this;var s=C.oStepPropertyMetadataHandler.oStep;var d=jQuery.Deferred();C.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var b=[];s.getConsumablePropertiesForRepresentation(C.oRepresentation.getId()).done(function(R){var A=R.consumable;A.forEach(function(p){var f;if(C.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)){f=C.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)["aggregation-role"];if(f===M.aggregationRoles.DIMENSION){b.push(p);}}});var S=C.getSelectedProperty();d.resolve(a.getPropertyListAndSelectedKey(b,S,C,R,t.addPrefixText));});});return d.promise();},getPropertyTextLabelKey:function(p){var C=this;return C.oRepresentation.getDimensionTextLabelKey(p);},removeProperties:function(){var C=this;C.getView().getViewData().oRepresentationHandler.getActualDimensions().forEach(function(p){C.oRepresentation.removeDimension(p.sProperty);});},updatePropertiesInConfiguration:function(p){var C=this;C.removeProperties();p.forEach(function(P){C.oRepresentation.addDimension(P.sProperty);C.oRepresentation.setDimensionKind(P.sProperty,P.sKind);C.oRepresentation.setLabelDisplayOption(P.sProperty,P.sLabelDisplayOption);C.oRepresentation.setDimensionTextLabelKey(P.sProperty,P.sTextLabelKey);});},createNewPropertyInfoAsPromise:function(n){var d=jQuery.Deferred();var C=this,N={};C.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var i=C.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,n);N.sProperty=n;N.sKind=C.getView().getViewData().oPropertyTypeData.sContext;N.sLabelDisplayOption=i?r.labelDisplayOptions.KEY_AND_TEXT:r.labelDisplayOptions.KEY;N.sTextLabelKey=undefined;d.resolve(N);});return d.promise();},setPropertyTextLabelKey:function(p,l){var C=this;C.oRepresentation.setDimensionTextLabelKey(p,l);},setNextPropertyInParentObject:function(){var C=this;C.updateOfConfigurationObjectAsPromise().then(function(){C.setDetailData();});},enableDisableLabelDisplayOptionTypeAsPromise:function(){var i,C=this;var d=jQuery.Deferred();var b=C.byId("idLabelDisplayOptionType");var p=t.removePrefixText(C.byId("idPropertyType").getSelectedKey(),C.oTextReader(M.texts.NOTAVAILABLE));C.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var I=C.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,p);if(p===C.oTextReader("none")){b.setEnabled(false);d.resolve();}else{b.setEnabled(true);for(i=0;i<b.getItems().length;i++){b.getItems()[i].setEnabled(true);if(i>0&&!I){b.getItems()[i].setEnabled(false);}}d.resolve();}});return d.promise();},changeLabelDisplayOption:function(l){var C=this;var p=t.removePrefixText(C.byId("idPropertyType").getSelectedKey(),C.oTextReader(M.texts.NOTAVAILABLE));C.oRepresentation.setLabelDisplayOption(p,l);},removePropertyFromParentObject:function(){var C=this;C.oRepresentation.removeDimension(t.removePrefixText(C.byId("idPropertyType").getSelectedKey(),C.oTextReader(M.texts.NOTAVAILABLE)));},addPropertyAsPromise:function(){var d=jQuery.Deferred();var C=this,A,b=[];var s=C.oStepPropertyMetadataHandler.oStep;C.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){s.getConsumablePropertiesForRepresentation(C.oRepresentation.getId()).done(function(R){R.consumable.forEach(function(p){if(C.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)){A=C.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)["aggregation-role"];if(A===M.aggregationRoles.DIMENSION){b.push(p);}}});C.getView().fireEvent(M.events.ADDPROPERTY,{"sProperty":b[0],"sContext":C.getView().getViewData().oPropertyTypeData.sContext,"bMandatory":C.getView().getViewData().oPropertyTypeData.bMandatory});C.oConfigurationEditor.setIsUnsaved();d.resolve();});});return d.promise();}});});
