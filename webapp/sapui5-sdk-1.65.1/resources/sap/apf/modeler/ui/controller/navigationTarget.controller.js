jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.viewValidator");jQuery.sap.require("sap.apf.modeler.ui.utils.staticValuesBuilder");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");(function(){"use strict";var p,t,T,c,C,n,v,N;var a;var b=sap.apf.modeler.ui.utils.nullObjectChecker;var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var d=sap.apf.modeler.ui.utils.TranslationFormatMap.NAVTARGET_TITLE;function _(i){i.byId("idNavigationTargetHeaderLabel").setText(t("basicData"));i.byId("idSemanticObjectLabel").setText(t("semanticObject"));i.byId("idActionLabel").setText(t("action"));i.byId("idDescriptionLabel").setText(t("navigationTargetTitle"));i.byId("idNavigationParametersHeaderLabel").setText(t("navigationParametersHeader"));i.byId("idNavigationTargetTypeHeaderLabel").setText(t("navigationTargetType"));i.byId("idNavigationTargetTypeLabel").setText(t("assignmentType"));i.byId("idAssignedStepsLabel").setText(t("assignedSteps"));i.byId("idContextMapping").setText(t("contextMapping"));}function e(i){var B;if(p&&p.arguments&&p.arguments.navTargetId){n=C.getNavigationTarget(p.arguments.navTargetId);}if(!b.checkIsNotUndefined(n)){B=C.createNavigationTarget();n=C.getNavigationTarget(B);s(i);}}function f(i){var B=n.getTitleKey()?t("navigationTargetTitle"):t("navigationTargetTitle")+" ("+t("default")+")";i.byId("idDescriptionLabel").setText(B);i.byId("idDescriptionLabel").setTooltip(B);i.byId("idUseDynamicParametersCheckBoxLabel").setText(t("useDynamicParametersLabel"));}function g(i){var B,D;var V={oTextReader:t,oConfigurationHandler:c,oConfigurationEditor:C,oParentObject:n,getCalatogServiceUri:i.getView().getViewData().getCalatogServiceUri,oCoreApi:i.getView().getViewData().oCoreApi};B=new sap.ui.controller("sap.apf.modeler.ui.controller.navTargetContextMapping");D=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:sap.ui.core.mvc.ViewType.XML,id:i.createId("idContextMappingView"),viewData:V,controller:B});i.getView().attachEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,D.getController().updateSubViewInstancesOnReset.bind(D.getController()));D.addStyleClass("formTopPadding");i.byId("idContextMappingVBox").insertItem(D);a=0;var E=n.getAllNavigationParameters();if(E.length>0){E.forEach(function(F){h(i,F);});}else{h(i);}}function h(i,B){var D=new sap.ui.controller("sap.apf.modeler.ui.controller.navigationTargetParameter");var E=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.navigationTargetParameter",type:sap.ui.core.mvc.ViewType.XML,id:i.createId("idNavigationTargetParameter"+a),viewData:{oTextReader:t,oParentController:i,oNavigationTarget:n,parameter:B,oConfigurationEditor:C},controller:D});i.byId("idNavigationParameterBox").addItem(E);a++;u(i);}function u(i){i.byId("idNavigationParameterBox").getItems().forEach(function(B){B.getController().checkVisibilityOfPlusMinus();});}function j(i){var P=jQuery.Deferred();N.getAllAvailableSemanticObjects(function(B,D){if(D===undefined){var M=o.prepareModel(B,B.length);i.byId("idSemanticObjectField").setModel(M);if(b.checkIsNotNullOrUndefinedOrBlank(n.getSemanticObject())){i.byId("idSemanticObjectField").setValue(n.getSemanticObject());}P.resolve();}else{z(i,D,"11504");}});return P.promise();}function k(i){var M,P;P=jQuery.Deferred();M=o.prepareModel([],0);i.byId("idActionField").setModel(M);m(undefined,i);l(i).then(function(S){P.resolve(S);});i.byId("idActionField").setValue(n.getAction());return P.promise();}function l(i){var M,S,P,B;B=new jQuery.Deferred();S=n.getSemanticObject();if(b.checkIsNotUndefined(S)){P=N.getSemanticActions(S);P.then(function(D){M=o.prepareModel(D.semanticActions,D.semanticActions.length);i.byId("idActionField").setModel(M);B.resolve(D);},function(D){z(i,D,"11505");});}return B.promise();}function m(S,B){var D,E,i;var F=n.getTitleKey();if(b.checkIsNotUndefined(F)){E=B.getView().getViewData().oConfigurationHandler.getTextPool().get(F).TextElementDescription;B.byId("idDescription").setValue(E);}else{var G=S?S:B.byId("idActionField").getModel().getData().Objects;if(G&&b.checkIsNotNullOrBlank(n.getAction())){for(i=0;i<G.length;i++){if(G[i].id===n.getAction()){D=G[i].text;break;}}}E=D?D:n.getSemanticObject();B.byId("idDescription").setValue(E);}}function q(i){var B=new sap.apf.modeler.ui.utils.StaticValuesBuilder(t,o);var M=B.getNavTargetTypeData();i.byId("idNavigationTargetTypeField").setModel(M);var D=n.isStepSpecific()?t("stepSpecific"):t("globalNavTargets");i.byId("idNavigationTargetTypeField").setSelectedKey(D);}function r(B){var D=n.isStepSpecific()?t("stepSpecific"):t("globalNavTargets");if(D===t("stepSpecific")){y(B,true);var E=[];var S=C.getSteps();var i,F;for(i=0;i<S.length;i++){F={};F.stepKey=S[i].getId();F.stepName=T.get(S[i].getTitleId()).TextElementDescription;E.push(F);}var M=o.prepareModel(E,E.length);B.byId("idAssignedStepsCombo").setModel(M);var G=C.getStepsAssignedToNavigationTarget(n.getId());B.byId("idAssignedStepsCombo").setSelectedKeys(G);}}function s(i){var B={id:n.getId(),icon:n.isGlobal()?"sap-icon://overview-chart":"sap-icon://pushpin-off"};if(i.byId("idDescription").getValue()){B.name=i.byId("idDescription").getValue();}N.updateSelectedNode(B);}function w(i){var F=t("navigationTarget")+": "+i.byId("idDescription").getValue();N.updateTitleAndBreadCrumb(F);}function x(i){var B={key:n.getId(),value:i.byId("idDescription").getValue()};N.setNavigationTargetName(B);}function y(i,I){i.byId("idAssignedStepsLabel").setVisible(I);i.byId("idAssignedStepsCombo").setVisible(I);}function z(i,M,B){var D=N.createMessageObject({code:B});D.setPrevious(M);N.putMessage(D);}function A(){var i=C.getStepsAssignedToNavigationTarget(n.getId());var B,S;for(B=0;B<i.length;B++){S=C.getStep(i[B]);S.removeNavigationTarget(n.getId());}}sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){var i=this;N=i.getView().getViewData();c=N.oConfigurationHandler;C=N.oConfigurationEditor;T=c.getTextPool();t=N.getText;p=N.oParams;if(!C){c.loadConfiguration(p.arguments.configId,function(B){C=B;});}_(i);v=new sap.apf.modeler.ui.utils.ViewValidator(i.getView());v.addFields(["idSemanticObjectField","idActionField"]);e(i);g(i);i.setDetailData();},onAfterRendering:function(){var i=this;if(i.getView().byId("idSemanticObjectField").getValue().length===0){i.getView().byId("idSemanticObjectField").focus();}},setDetailData:function(){var i=this;j(i).then(function(){k(i).then(function(S){m(S.semanticActions,i);});});f(i);q(i);r(i);var B=n.getUseDynamicParameters();if(B){this.getView().byId("idUseDynamicParametersCheckBox").setSelected(true);}else{this.getView().byId("idUseDynamicParametersCheckBox").setSelected(false);}},updateSubViewInstancesOnReset:function(i){var B=this;C=i;n=C.getNavigationTarget(n.getId());B.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,{"oConfigurationEditor":C,"oParentObject":n});},handleChangeSemanticObjectValue:function(E){var S,i=this;S=E.getParameter("value").trim();n.setTitleKey(undefined);if(b.checkIsNotNullOrBlank(S)){n.setSemanticObject(S);l(i).then(function(B){if(B.semanticActions.length>0){n.setAction(i.byId("idActionField").getModel().getData().Objects[0].id);i.byId("idActionField").setSelectedKey(B.semanticActions[0].id);}else{i.byId("idActionField").setValue("");}m(B.semanticActions,i);f(i);s(i);w(i);x(i);});}C.setIsUnsaved();},handleChangeofAction:function(E){var i,B=this;i=E.getParameter("value");n.setTitleKey(undefined);if(b.checkIsNotNullOrBlank(i)){n.setAction(i);}m(undefined,B);f(B);s(B);w(B);x(B);C.setIsUnsaved();},handleChangeForTitleText:function(){var i=this,L;var B=i.byId("idDescription").getValue();if(B.trim().length===0){L=undefined;n.setTitleKey(L);m(undefined,i);f(i);s(i);w(i);x(i);C.setIsUnsaved();}else{i.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(B,d).done(function(L){n.setTitleKey(L);f(i);i.byId("idDescription").setValue(B);s(i);w(i);x(i);C.setIsUnsaved();});}},handleSuggestions:function(E){var S=new sap.apf.modeler.ui.utils.SuggestionTextHandler(T);S.manageSuggestionTexts(E,d);},handleChangeOfNavigationTargetType:function(){var i=this;C.setIsUnsaved();var B=i.byId("idNavigationTargetTypeField").getSelectedKey();if(B===t("stepSpecific")){n.setStepSpecific();r(i);}else{n.setGlobal();y(i,false);i.byId("idAssignedStepsCombo").setSelectedKeys([]);A();}s(i,i.byId("idDescription").getValue());},handleChangeForAssignedSteps:function(){var i=this;C.setIsUnsaved();var B=i.byId("idAssignedStepsCombo").getSelectedKeys();var D=C.getStepsAssignedToNavigationTarget(n.getId());D.forEach(function(S){if(B.indexOf(S)===-1){var E=C.getStep(S);E.removeNavigationTarget(n.getId());}});B.forEach(function(S){if(D.indexOf(S)===-1){var E=C.getStep(S);E.addNavigationTarget(n.getId());}});},getValidationState:function(){var i=this;var B=true;i.byId("idNavigationParameterBox").getItems().forEach(function(D){if(!D.getController().validate()){B=false;}});return v.getValidationState()&&i.byId("idContextMappingView").getController().getValidationState()&&B;},getNavigationParameters:function(){return this.byId("idNavigationParameterBox").getItems();},addNavigationParameter:function(){h(this);},removeNavigationParameter:function(i){this.byId("idNavigationParameterBox").removeItem(i);u(this);},handleChangeForUseDynamicParameters:function(){var i=this.byId("idUseDynamicParametersCheckBox").getSelected();n.setUseDynamicParameters(i);},onExit:function(){var i=this;i.byId("idContextMappingView").destroy();},displayHelpAboutDynamicParameters:function(){var i=t("explanationOfDynamicParameters");var B=t("titleDynamicParameters");sap.m.MessageBox.show(i,{icon:sap.m.MessageBox.Icon.INFORMATION,title:B,actions:[sap.m.MessageBox.Action.CLOSE]});}});}());
