/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/controller/representationDimension.controller","sap/apf/modeler/ui/utils/textManipulator"],function(B,t){"use strict";return B.extend("sap.apf.modeler.ui.controller.representationLegend",{getAllPropertiesAsPromise:function(){var c=this,a,s,p,A,d=[];var S=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;var b=jQuery.Deferred();c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){S.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(r){a=r.consumable;a.forEach(function(P){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(e,P)){A=c.oStepPropertyMetadataHandler.getPropertyMetadata(e,P)["aggregation-role"];if(A===C.aggregationRoles.DIMENSION){d.push(P);}}});s=c.getSelectedProperty();if(s!==c.oTextReader("none")&&s!==undefined){p=d.indexOf(s)!==-1?d:d.concat(s);d=r.available.indexOf(s)!==-1?p:d.concat(t.addPrefixText([s],c.oTextReader));s=r.available.indexOf(s)!==-1?s:t.addPrefixText([s],c.oTextReader)[0];}d.splice(0,0,c.oTextReader("none"));b.resolve({aAllProperties:d,sSelectedKey:s});});});return b.promise();},removeProperties:function(){var c=this;c.getView().getViewData().oRepresentationHandler.getActualLegends().forEach(function(p){c.oRepresentation.removeDimension(p.sProperty);});},enableDisableLabelDisplayOptionTypeAsPromise:function(){var d=jQuery.Deferred();var i,c=this;var a=c.byId("idLabelDisplayOptionType");var p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),c.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var I=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,p);if(p===c.oTextReader("none")){a.setEnabled(false);d.resolve();return;}a.setEnabled(true);for(i=0;i<a.getItems().length;i++){a.getItems()[i].setEnabled(true);if(i>0&&!I){a.getItems()[i].setEnabled(false);}}d.resolve();});return d.promise();},addPropertyAsPromise:function(){var d=jQuery.Deferred();var c=this,a,D=[];var s=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){s.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(r){r.consumable.forEach(function(p){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)){a=c.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)["aggregation-role"];if(a===C.aggregationRoles.DIMENSION){D.push(p);}}});c.getView().fireEvent(C.events.ADDPROPERTY,{"sProperty":D[0],"sContext":c.getView().getViewData().oPropertyTypeData.sContext});c.oConfigurationEditor.setIsUnsaved();d.resolve();});});return d.promise();}});});
