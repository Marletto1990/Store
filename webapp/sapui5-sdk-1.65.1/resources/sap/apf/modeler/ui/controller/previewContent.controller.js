/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.require("sap.apf.ui.utils.constants");jQuery.sap.require("sap.apf.utils.utils");(function(){'use strict';var r,R,p,c,t,o,s,a;var T=sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;function _(C){var S=p.getLongTitleId();var i=S&&!c.getTextPool().isInitialTextKey(S)?S:p.getTitleId();var M=r.getMainContent(b(i),480,330);C.byId("idMainChart").addItem(M);}function b(S){var i=S&&c.getTextPool().get(S),n;if(i!==undefined){n=i.TextElementDescription;}return n;}function d(M){var P=b(R[M]());if(P===undefined){P=b(p[M]());}return P;}function e(C){var S=p.getTitleId();var i=b(S);C.byId("idStepTitleText").setText(i);C.byId("idThumbnailChartLayout").addItem(r.getThumbnailContent());C.byId("idLeftUpperCornerText").setText(d("getLeftUpperCornerTextKey"));C.byId("idRightUpperCornerText").setText(d("getRightUpperCornerTextKey"));C.byId("idLeftLowerCornerText").setText(d("getLeftLowerCornerTextKey"));C.byId("idRightLowerCornerText").setText(d("getRightLowerCornerTextKey"));}function f(C){_(C);e(C);}function g(D,S){return D.sort(function(n,q){var u,i;for(i=0;i<S.length;i++){if(n[S[i].property]<q[S[i].property]){u=-1;}else if(n[S[i].property]>q[S[i].property]){u=1;}u=u*[1,-1][+!S[i].ascending];if(u!==0){return u;}}});}function h(L,A){var i=jQuery.Deferred();s.getEntityTypeMetadataAsPromise().done(function(n){var P,q,u=[];A.forEach(function(D){if(D.sProperty!==t("none")&&D.sProperty!==""){q=L(D.sProperty);if(q!==undefined){P=c.getTextPool().get(q).TextElementDescription;}else{P=s.getDefaultLabel(n,D.sProperty);}u.push({fieldName:D.sProperty,fieldDesc:P,kind:D.sContext});}});i.resolve(u);});return i.promise();}function j(P){var i=jQuery.Deferred();var n=[];if(P==="properties"&&R.getRepresentationType()===T){h(R.getPropertyTextLabelKey,o.getActualProperties()).done(function(A){n=A;});}else if(P==="dimensions"&&R.getRepresentationType()!==T){s.getEntityTypeMetadataAsPromise().done(function(E){h(R.getDimensionTextLabelKey,o.getActualDimensions().concat(o.getActualLegends())).done(function(A){n=A;});});}else if(P==="measures"&&R.getRepresentationType()!==T){s.getEntityTypeMetadataAsPromise().done(function(E){h(R.getMeasureTextLabelKey,o.getActualMeasures()).done(function(A){n=A;n.forEach(function(q){var u=R.getMeasureDisplayOption(q.fieldName);if(u){q.measureDisplayOption=u;}});});});}i.resolve(n);return i.promise();}function k(){var n=jQuery.Deferred();var S=[],q=[],i=0,u=3;var P=s.getProperties();s.getEntityTypeMetadataAsPromise().done(function(E){var D=s.getDimensionsProperties(E);var M=s.getMeasures(E);var C=R.getRepresentationType();var v=C!==T?Math.pow(u,D.length):7;for(i=0;i<v;i++){var w={};if(C===T){P.forEach(function(x){var y=x+" - "+sap.apf.utils.createRandomNumberString(4);w[x]=y;});}else{D.forEach(function(x,y){var z=x+" - "+(Math.floor(i/Math.pow(u,y))%u+1);w[x]=z;});M.forEach(function(x){var y=sap.apf.utils.createRandomNumberString(4);w[x]=y;});}S.push(w);}q=R.getOrderbySpecifications();if(q&&q.length){S=g(S,q);}n.resolve(S);});return n.promise();}function l(){var i=a.getConstructorOfRepresentationType(R.getRepresentationType());jQuery.sap.require(i);var n=sap.apf.utils.extractFunctionFromModulePathString(i);var P={};P.requiredFilters=[];function q(u){return u;}function E(){}var A={getTextNotHtmlEncoded:q,getTextHtmlEncoded:q,getEventCallback:E,getExits:function(){var u={};return u;},getUiApi:function(){var u={};u.getStepContainer=function(){return undefined;};return u;},createFilter:function(){return{getOperators:function(){return{EQ:true};},getTopAnd:function(){return{addOr:E};},getInternalFilter:function(){return{getProperties:function(){return[];}};}};},createMessageObject:E,putMessage:E,updatePath:E,selectionChanged:E,getActiveStep:function(){return{getSelectedRepresentation:function(){return{bIsAlternateView:true};}};}};j("dimensions").done(function(D){P.dimensions=D;});j("measures").done(function(u){P.measures=u;});j("properties").done(function(u){P.properties=u;});r=new n(A,P);if(r.chartType===T){r.oTableRepresentation.removeEventDelegate();r.oTableRepresentation.onAfterRendering(function(){return;});}var M={getPropertyMetadata:function(u){return{label:u};}};k().done(function(u){r.setData(u,M);});}function m(C){var P=C.byId("idPreviewContentDialog");P.setTitle(t("preview"));P.getEndButton().setText(t("close"));}sap.ui.controller("sap.apf.modeler.ui.controller.previewContent",{onInit:function(){var C=this;var P=C.byId("idPreviewContentDialog");R=C.getView().getViewData().oRepresentation;p=C.getView().getViewData().oParentStep;c=C.getView().getViewData().oConfigurationHandler;t=C.getView().getViewData().oCoreApi.getText;o=C.getView().getViewData().oRepresentationHandler;s=C.getView().getViewData().oStepPropertyMetadataHandler;a=C.getView().getViewData().oRepresentationTypeHandler;m(C);l();f(C);P.open();},handleCloseButtonOfDialog:function(){var C=this;C.byId("idPreviewContentDialog").close();},handleClose:function(){var C=this;C.byId("idPreviewContentDialog").destroy();C.getView().destroy();}});}());
