/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.staticValuesBuilder");jQuery.sap.require('sap.apf.modeler.ui.utils.constants');jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.utils.utils");(function(){"use strict";var p='idSortProperty';var s='idSortDirection';var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var t=sap.apf.modeler.ui.utils.textManipulator;var c=sap.apf.modeler.ui.utils.CONSTANTS.events;function _(C){C.byId("idSortLabel").setText(C.oTextReader("sortingField"));C.byId("idSortLabel").setTooltip(C.oTextReader("sortingField"));C.byId("idSortDirectionLabel").setText(C.oTextReader("direction"));C.byId("idSortDirectionLabel").setTooltip(C.oTextReader("direction"));C.byId("idAddPropertyIcon").setTooltip(C.oTextReader("addButton"));C.byId("idRemovePropertyIcon").setTooltip(C.oTextReader("deleteButton"));}function a(C){if(sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>=11){C.byId("idAriaPropertyForSortGroup").setText(C.oTextReader("sorting"));}C.byId("idAriaPropertyForAdd").setText(C.oTextReader("ariaTextForAddIcon"));C.byId("idAriaPropertyForDelete").setText(C.oTextReader("ariaTextForDeleteIcon"));}function b(C){var g=C.byId(p);C.getAllPropertiesAsPromise().done(function(r){var m=o.convert(r.aAllProperties);g.setModel(m);g.setSelectedKey(r.sSelectedKey);});}function d(C){var g=C.byId(s);var h=new sap.apf.modeler.ui.utils.StaticValuesBuilder(C.oTextReader,o);var m=h.getSortDirections();g.setModel(m);g.setSelectedKey(C.getView().getViewData().oPropertyTypeData.sContext);}function e(C){var S=true,g=true;var P=C.getView().getViewData().oPropertyTypeState;if(P.indexOfPropertyTypeViewId(C.getView().getId())===0){g=false;}C.byId("idAddPropertyIcon").setVisible(S);C.byId("idRemovePropertyIcon").setVisible(g);}function f(C){C.byId("idAddPropertyIcon").attachEvent(c.SETFOCUSONADDICON,C.setFocusOnAddRemoveIcons.bind(C));}sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var C=this;C.oConfigurationEditor=C.getView().getViewData().oConfigurationEditor;C.oParentObject=C.getView().getViewData().oParentObject;C.oStepPropertyMetadataHandler=C.getView().getViewData().oStepPropertyMetadataHandler;C.oTextReader=C.getView().getViewData().oCoreApi.getText;C.setDetailData();},onAfterRendering:function(){var C=this;C.byId("idAddPropertyIcon").fireEvent(c.SETFOCUSONADDICON);},setDetailData:function(){var C=this;_(C);a(C);b(C);d(C);e(C);C.disableView();},handleChangeForSortProperty:function(g){var C=this;var S=t.removePrefixText(C.byId(p).getSelectedKey(),C.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));var P=C.getView().getViewData().oPropertyOrchestration;var v=C.getView().getId();return new Promise(function(r){C.getView().fireEvent(c.UPDATEPROPERTYVALUESTATE,{"sProperty":S});P.updatePropertyTypeRow(v,S);P.updateAllSelectControlsForPropertyType().then(function(){C.updateOfConfigurationObject();C.oConfigurationEditor.setIsUnsaved();r();});});},handleChangeForSortDirection:function(){var C=this;C.updateOfConfigurationObject();C.oConfigurationEditor.setIsUnsaved();},setFocusOnAddRemoveIcons:function(){var C=this;C.byId("idAddPropertyIcon").focus();},handlePressOfAddPropertyIcon:function(){var C=this;f(C);C.addPropertyAsPromise();},handlePressOfRemovePropertyIcon:function(){var C=this;var v=C.getView().getViewData();return new Promise(function(r){C.getView().fireEvent(c.FOCUSONREMOVE);var P=v.oPropertyOrchestration;P.removePropertyTypeReference(C.getView().getId());P.updateAllSelectControlsForPropertyType().then(function(){C.updateOfConfigurationObject();v.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:C.getView()});C.oConfigurationEditor.setIsUnsaved();C.getView().destroy();r();});});},updateOfConfigurationObject:function(){var C=this;var P=C.getView().getViewData().oPropertyOrchestration;var g=P.getSortPropertyInformationList(s);C.updateOfConfigurationObjectOfSubclass(g);},getSelectedSortProperty:function(){var C=this;var P=C.getView().getViewData().oPropertyTypeState;var g=P.getPropertyValueState();var n=P.indexOfPropertyTypeViewId(C.getView().getId());return g[n];},removeAllItemsFromDropDownList:function(){var C=this;var v=C.byId(p);v.getItems().forEach(function(i){v.removeItem(i);});},setItemsOfDropDownList:function(C,A,g){function h(l,m){return l.indexOf(m)!==-1;}var i=this;var v=i.byId(p);var j=(g===i.oTextReader("none"));var k=JSON.parse(JSON.stringify(C));v.addItem(new sap.ui.core.Item({key:i.oTextReader("none"),text:i.oTextReader("none")}));if(!h(k,g)&&!j){k.unshift(g);}k=k.filter(function(l){return l!==i.oTextReader("none");});k.forEach(function(V){var u=V;if(!h(A,V)&&!j){V=t.addPrefixText([V],i.oTextReader)[0];}var I=new sap.ui.core.Item({key:V,text:V});v.addItem(I);if(u===g){g=V;}});v.setSelectedKey(g);},updateOfConfigurationObjectOfSubclass:function(S){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return sap.apf.utils.createPromise();}});}());
