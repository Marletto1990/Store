/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/propertyTypeOrchestration"],function(m,p){'use strict';function R(r,s,o,v){this.oRepresentationView=r;this.oRepresentation=o.oRepresentation;this.oStepPropertyMetadataHandler=s;this.oRepresentationTypeHandler=o.oRepresentationTypeHandler;this.oRepresentationHandler=o;this.nCounter=0;this.oViewValidator=v;this.propertyTypeHandlerPromises=[];}R.prototype._prepareCommonView=function(r,P,e,o){var v,V={},f={};if(e.length===0){return;}f.oConfigurationEditor=r.oRepresentationView.getViewData().oConfigurationEditor;f.oParentObject=r.oRepresentation;f.oCoreApi=r.oRepresentationView.getViewData().oCoreApi;f.oConfigurationHandler=r.oRepresentationView.getViewData().oConfigurationHandler;f.oRepresentationTypeHandler=r.oRepresentationTypeHandler;f.oRepresentationHandler=r.oRepresentationHandler;f.oStepPropertyMetadataHandler=r.oStepPropertyMetadataHandler;f.sPropertyType=P;f.oBasicDataLayout=r.oRepresentationView.getController().byId("idBasicDataLayout");f.oTextPool=r.oRepresentationView.getViewData().oConfigurationHandler.getTextPool();f.oViewValidator=r.oViewValidator;V.oViewDataForPropertyType=f;V.aPropertiesToBeCreated=e;V.oPropertyOrchestration=o;v=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.propertyTypeHandler",type:sap.ui.core.mvc.ViewType.XML,id:r.oRepresentationView.getController().createId("id"+P),viewData:V});r.oRepresentationView.getController().byId("idBasicDataLayout").insertItem(v,r.nCounter);r.nCounter++;r.oRepresentationView.attachEvent(m.events.REMOVEALLPROPERTIESFROMPARENTOBJECT,v.getController().handleRemoveOfProperty.bind(v.getController()));r.propertyTypeHandlerPromises.push(v.getController().initPromise);};function _(r,P){r._prepareCommonView(r,m.propertyTypes.DIMENSION,r.oRepresentationHandler.getActualDimensions(),P);}function a(r,P){r._prepareCommonView(r,m.propertyTypes.LEGEND,r.oRepresentationHandler.getActualLegends(),P);}function b(r,P){r._prepareCommonView(r,m.propertyTypes.MEASURE,r.oRepresentationHandler.getActualMeasures(),P);}function c(r,P){r._prepareCommonView(r,m.propertyTypes.PROPERTY,r.oRepresentationHandler.getActualProperties(),P);}function d(r,P){r._prepareCommonView(r,m.propertyTypes.HIERARCHIALCOLUMN,r.oRepresentationHandler.getHierarchicalProperty(),P);}R.prototype.instantiateBasicDataAsPromise=function(){var e=this;var r=e.oRepresentation.getId();var f=jQuery.Deferred();this.propertyTypeHandlerPromises.push(f);p.getConsumableAndAvailablePropertiesAsPromise(r,m.aggregationRoles.DIMENSION,e.oStepPropertyMetadataHandler).then(function(D){p.getConsumableAndAvailablePropertiesAsPromise(r,m.aggregationRoles.MEASURE,e.oStepPropertyMetadataHandler).then(function(M){var P;var o;var g;e.destroyBasicData();if(e.oRepresentation.getRepresentationType()==="TreeTableRepresentation"){g=new p.PropertyTypeOrchestration();d(e,g);c(e,g);}else if(e.oRepresentation.getRepresentationType()==="TableRepresentation"){g=new p.PropertyTypeOrchestration();c(e,g);}else{o=new p.PropertyTypeOrchestration();_(e,o);a(e,o);P=new p.PropertyTypeOrchestration();b(e,P);}f.resolve();});});return jQuery.when.apply(jQuery,this.propertyTypeHandlerPromises);};R.prototype.destroyBasicData=function(){this.oViewValidator.clearFields();this.nCounter=0;this.oRepresentationView.getController().byId("idBasicDataLayout").destroyItems();};return R;});
