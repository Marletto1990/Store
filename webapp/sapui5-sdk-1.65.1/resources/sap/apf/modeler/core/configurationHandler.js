/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.configurationHandler");jQuery.sap.require('sap.apf.modeler.core.configurationEditor');jQuery.sap.require("sap.apf.utils.hashtable");jQuery.sap.require("sap.apf.utils.utils");jQuery.sap.require("sap.apf.modeler.core.configurationObjects");(function(){'use strict';sap.apf.modeler.core.ConfigurationHandler=function(a){var t=this;var m=a.instances.messageHandler;var p=a.instances.persistenceProxy;var C=a.constructors.ConfigurationEditor;var H=a.constructors.Hashtable;var L=a.constructors.LazyLoader;var c=new H(m);var b=new H(m);var l=new H(m);var d=new H(m);var e,f;var g={constructors:{Hashtable:H},instances:{messageHandler:m}};this.exportTexts=function(i){var j=this.getConfiguration(i).AnalyticalConfigurationName;return f.exportTexts(j);};this.getTextPool=function(){return f;};this.setApplicationIdAndContext=function(j,k,T){f=T||f;c=new H(m);var i,n=k.length;for(i=0;i<n;i++){c.setItem(k[i].AnalyticalConfiguration,k[i]);b.setItem(k[i].AnalyticalConfiguration,k[i].AnalyticalConfigurationName);}e=j;};this.getApplicationId=function(){return e;};this.setConfiguration=function(i,j){i.AnalyticalConfiguration=j||h();i.Application=e;c.setItem(i.AnalyticalConfiguration,i);return i.AnalyticalConfiguration;};this.getList=function(){var i=[];var j=function(k,n){i.push(n);};c.each(j);return i;};this.getConfiguration=function(i){return c.getItem(i);};this.loadConfiguration=function(i,j){var k,n=i.id||i;if(!i.updateExisting){k=l.getItem(n);}if(!k){k=new L(g,q);l.setItem(n,k);}k.asyncGetInstance(n,o);function o(r,s,u){j(r,s);}function q(n,r,s){var u={instances:{coreApi:a.instances.coreApi,messageHandler:m,configurationHandler:t,persistenceProxy:p,textPool:f,metadataFactory:a.instances.metadataFactory},constructors:{Hashtable:H,Step:a.constructors.Step,HierarchicalStep:a.constructors.HierarchicalStep,SmartFilterBar:a.constructors.SmartFilterBar,FacetFilter:a.constructors.FacetFilter,NavigationTarget:a.constructors.NavigationTarget,Representation:a.constructors.Representation,ConfigurationObjects:a.constructors.ConfigurationObjects,ElementContainer:a.constructors.ElementContainer,ConfigurationFactory:a.constructors.ConfigurationFactory,RegistryProbe:a.constructors.RegistryProbe}};new C(i,u,function(v,w){r(n,v,w);});}};this.resetConfiguration=function(i){var j;if(l.hasItem(i)){j=c.getItem(i);j.AnalyticalConfigurationName=b.getItem(i);l.removeItem(i);return i;}};this.updateConfigurationName=function(i,j){b.setItem(i,j);};this.copyConfiguration=function(i,j){var k=this.getConfiguration(i);if(!k){j(null);return;}t.loadConfiguration(i,n);function n(o){var q,r,s,u;u=sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(k);q=h();u.AnalyticalConfiguration=q;t.setConfiguration(u,q);r=o.copy(q);s=new L(g,undefined,{id:q,instance:r});l.setItem(q,s);j(q);}};this.replaceConfigurationId=function(i,s){if(i.indexOf("apf1972-")===0){var j=c.getItem(i);var k=l.getItem(i).getInstance();var n=new L(g,undefined,{id:s,instance:k});j.AnalyticalConfiguration=s;c.setItem(s,j);b.setItem(s,j.AnalyticalConfigurationName);c.removeItem(i);l.setItem(s,n);l.removeItem(i);}};this.exportConfiguration=function(i,j){var o;this.loadConfiguration(i,k);function k(n){if(!n.isSaved()){m.putMessage(m.createMessageObject({code:"11007",aParameters:[i]}));j(null);}else{var q=a.functions.getApplication(e);var r=t.getConfiguration(i).AnalyticalConfigurationName;o=n.serialize();o.configHeader={Application:e,ApplicationName:q.ApplicationName,SemanticObject:q.SemanticObject,AnalyticalConfiguration:i,AnalyticalConfigurationName:r,UI5Version:sap.ui.version};p.readEntity("configuration",function(s,u,v){if(v){m.putMessage(m.createMessageObject({code:"5022",aParameters:[i]}));j(null);}else{o.configHeader.CreationUTCDateTime=s.CreationUTCDateTime;o.configHeader.LastChangeUTCDateTime=s.LastChangeUTCDateTime;o=JSON.stringify(o,null,'\t');j(o,r);}},[{name:"AnalyticalConfiguration",value:i}],["CreationUTCDateTime","LastChangeUTCDateTime"],e);}}};this.memorizeConfiguration=function(i){var j,k;k=l.getItem(i);if(!k){return null;}j=k.getInstance();if(j){d.setItem(i,j.copy(i));return i;}return null;};this.restoreMemorizedConfiguration=function(i){var n,j;j=d.removeItem(i);if(j){n=new L(g,undefined,{id:i,instance:j});l.setItem(i,n);return j;}return null;};this.removeConfiguration=function(i,r){function j(k,n){if(!n){c.removeItem(i);l.removeItem(i);}r(i,k,n);}if(i.indexOf("apf1972-")!==0){p.remove("configuration",[{name:"AnalyticalConfiguration",value:i}],j,undefined,e);}else{c.removeItem(i);l.removeItem(i);r(i,undefined,undefined);}};this.removeAllConfigurations=function(){c=new H(m);};function h(){return"apf1972-"+(sap.apf.utils.createPseudoGuid(32));}};}());
