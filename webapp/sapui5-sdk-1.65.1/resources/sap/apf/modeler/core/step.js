/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.step");(function(){'use strict';sap.apf.modeler.core.Step=function(s,a,d){var r,b,c,f,e,g,t,n,k,h,l,j,m,o,p,q,u,v,w,x,y;u=a.instances.messageHandler;if(!d){r=new a.constructors.ElementContainer(s+"-Representation",a.constructors.Representation,a);b={};c=new a.constructors.ElementContainer("SelectProperty",undefined,a);f=new a.constructors.ElementContainer("FilterProperty",undefined,a);e={};g=new a.constructors.ElementContainer("SelectPropertyForFilterMapping",undefined,a);t=new a.constructors.ElementContainer("TargetPropertyForFilterMapping",undefined,a);k=false;n=new a.constructors.ElementContainer("NavigationTarget",undefined,a);}else{r=d.representationContainer;b=d.request;c=d.selectProperties;f=d.filterProperties;v=d.filterPropertyLabelKey;w=d.filterPropertyLabelDisplayOption;x=d.targetPropertyLabelKey;y=d.targetPropertyLabelDisplayOption;e=d.requestForFilterMapping;g=d.selectPropertiesForFilterMapping;t=d.targetPropertiesForFilterMapping;k=d.keepSourceForFilterMapping;n=d.navigationTargets;h=d.titleId;l=d.longTitleId;j=d.leftUpperCornerTextKey;m=d.rightUpperCornerTextKey;o=d.leftLowerCornerTextKey;p=d.rightLowerCornerTextKey;q=d.topNSettings;}this.getType=function(){return"step";};this.getId=function(){return s;};this.setTopN=function(i,A){if(A&&A instanceof Array&&A.length>0){this.resetTopN();q={};q.top=i;q.orderby=A;}else{u.putMessage(u.createMessageObject({code:11016}));return;}r.getElements().forEach(function(B){B.setTopN(i);q.orderby.forEach(function(A){B.addOrderbySpec(A.property,A.ascending);});});};this.setTopNValue=function(i){if(!q){q={};}q.top=i;if(q.orderby){z();}};this.setTopNSortProperties=function(i){if(!q){q={};}if(i&&i.length>0){i.forEach(function(A){if(A.ascending==="true"){A.ascending=true;}});}q.orderby=i;if(q.top){z();}};function z(){r.getElements().forEach(function(i){i.setTopN(q.top);i.removeAllOrderbySpecs();q.orderby.forEach(function(A){i.addOrderbySpec(A.property,A.ascending);});});}this.getTopN=function(){if(q&&q.top>0){if(jQuery.isArray(q.orderby)){var c=this.getSelectProperties();var i;for(i=q.orderby.length-1;i>=0;i--){if(jQuery.inArray(q.orderby[i].property,c)<0){q.orderby.splice(i,1);z();}}}return jQuery.extend({},true,q);}};this.resetTopN=function(){q=undefined;r.getElements().forEach(function(i){if(i.getTopN()){i.setTopN(undefined);}});};this.getService=function(){return b.service;};this.setService=function(i){b.service=i;};this.getEntitySet=function(){return b.entitySet;};this.setEntitySet=function(i){b.entitySet=i;};this.setTitleId=function(i){h=i;};this.getTitleId=function(){return h;};this.setLongTitleId=function(i){l=i;};this.getLongTitleId=function(){return l;};this.getSelectProperties=function(){var i=[];var A=c.getElements();A.forEach(function(B){i.push(B.getId());});return i;};this.addSelectProperty=function(i){c.createElementWithProposedId(undefined,i);};this.removeSelectProperty=function(i){c.removeElement(i);};this.getFilterProperties=function(){var i=[];var F=f.getElements();F.forEach(function(A){i.push(A.getId());});return i;};this.addFilterProperty=function(i){v=undefined;w=undefined;return f.createElementWithProposedId(undefined,i).getId();};this.removeFilterProperty=function(i){v=undefined;w=undefined;f.removeElement(i);};this.setFilterPropertyLabelKey=function(i){v=i;};this.getFilterPropertyLabelKey=function(){return v;};this.setFilterPropertyLabelDisplayOption=function(i){w=i;};this.getFilterPropertyLabelDisplayOption=function(){return w;};this.setFilterMappingService=function(i){e.service=i;};this.getFilterMappingService=function(){return e.service;};this.setFilterMappingEntitySet=function(i){e.entitySet=i;};this.getFilterMappingEntitySet=function(){return e.entitySet;};this.addFilterMappingTargetProperty=function(i){x=undefined;y=undefined;t.createElementWithProposedId(undefined,i);};this.getFilterMappingTargetProperties=function(){var i=[];var A=t.getElements();A.forEach(function(B){i.push(B.getId());});return i;};this.removeFilterMappingTargetProperty=function(i){x=undefined;y=undefined;t.removeElement(i);};this.setFilterMappingTargetPropertyLabelKey=function(i){x=i;};this.getFilterMappingTargetPropertyLabelKey=function(){return x;};this.setFilterMappingTargetPropertyLabelDisplayOption=function(i){y=i;};this.getFilterMappingTargetPropertyLabelDisplayOption=function(){return y;};this.addNavigationTarget=function(i){n.createElementWithProposedId(undefined,i);};this.getNavigationTargets=function(){var i=[];var A=n.getElements();A.forEach(function(B){i.push(B.getId());});return i;};this.removeNavigationTarget=function(i){n.removeElement(i);};this.setFilterMappingKeepSource=function(i){k=i;};this.getFilterMappingKeepSource=function(){return k;};this.getRepresentations=r.getElements;this.getRepresentation=r.getElement;this.createRepresentation=function(i){var A;if(i&&i.id){A=r.createElementWithProposedId(i,i.id);}else{A=r.createElement(i);}if(q&&q.top){A.setTopN(q.top);q.orderby.forEach(function(B){A.addOrderbySpec(B.property,B.ascending);});}return A;};this.removeRepresentation=r.removeElement;this.copyRepresentation=r.copyElement;this.moveRepresentationBefore=function(i,A){return r.moveBefore(i,A);};this.moveRepresentationUpOrDown=function(i,A){return r.moveUpOrDown(i,A);};this.moveRepresentationToEnd=function(i){return r.moveToEnd(i);};this.setLeftUpperCornerTextKey=function(i){j=i;};this.getLeftUpperCornerTextKey=function(){return j;};this.setRightUpperCornerTextKey=function(i){m=i;};this.getRightUpperCornerTextKey=function(){return m;};this.setLeftLowerCornerTextKey=function(i){o=i;};this.getLeftLowerCornerTextKey=function(){return o;};this.setRightLowerCornerTextKey=function(i){p=i;};this.getRightLowerCornerTextKey=function(){return p;};this.getConsumablePropertiesForTopN=function(){var i=jQuery.Deferred();this.getAvailableProperties().done(function(A){var B=[];if(q&&q.orderby&&q.orderby.length>0){q.orderby.forEach(function(C){B.push(C.property);});}i.resolve({available:A,consumable:this.getConsumableProperties(A,B)});}.bind(this));return i.promise();};this.getConsumablePropertiesForRepresentation=function(i){var A=jQuery.Deferred();function B(C){var D=[];jQuery.merge(D,C.getDimensions());jQuery.merge(D,C.getMeasures());jQuery.merge(D,C.getProperties());return D;}this.getAvailableProperties().done(function(C){if(this.getHierarchyProperty&&this.getHierarchyProperty()){C.push(this.getHierarchyProperty());}var D=[];var E=r.getElement(i);if(E){D=B(E);if(E.getHierarchyProperty){D.push(E.getHierarchyProperty());}}else{D=this.getSelectProperties();}A.resolve({available:C,consumable:this.getConsumableProperties(C,D)});}.bind(this));return A.promise();};this.getConsumableSortPropertiesForRepresentation=function(i){var A=jQuery.Deferred();this.getAvailableProperties().done(function(B){A.resolve({available:B,consumable:this.getConsumableProperties(B,this.getSortPropertiesFromRepresentation(i))});}.bind(this));return A.promise();};this.getSortPropertiesFromRepresentation=function(i){var A=[];var B=r.getElement(i);var C=B.getOrderbySpecifications();C.forEach(function(D){A.push(D.property);});return A;};this.getConsumableProperties=function(i,A){var B=[];i.forEach(function(C){if(jQuery.inArray(C,A)===-1){B.push(C);}});return B;};this.getAvailableProperties=function(){var i=jQuery.Deferred();var A=[];if(b.service&&b.entitySet){a.instances.metadataFactory.getMetadata(b.service).then(function(B){if(B){var C=B.getAllPropertiesOfEntitySet(b.entitySet);var D=this.getSelectProperties();D.forEach(function(E){if(jQuery.inArray(E,C)!==-1){A.push(E);}});}i.resolve(A);}.bind(this),function(){i.resolve([]);});}else{i.resolve([]);}return i.promise();};this.copy=function(i){var d=sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(this.getDataForCopy());d.representationContainer=r.copy((i||this.getId())+"-Representation");return new sap.apf.modeler.core.Step((i||this.getId()),a,d);};this.getDataForCopy=function(){return{request:b,selectProperties:c,filterProperties:f,filterPropertyLabelKey:v,filterPropertyLabelDisplayOption:w,requestForFilterMapping:e,selectPropertiesForFilterMapping:g,targetPropertiesForFilterMapping:t,targetPropertyLabelKey:x,targetPropertyLabelDisplayOption:y,navigationTargets:n,keepSourceForFilterMapping:k,titleId:h,longTitleId:l,leftUpperCornerTextKey:j,rightUpperCornerTextKey:m,leftLowerCornerTextKey:o,rightLowerCornerTextKey:p,topNSettings:q};};this.getRepresentationContainer=function(){return r;};};}());
