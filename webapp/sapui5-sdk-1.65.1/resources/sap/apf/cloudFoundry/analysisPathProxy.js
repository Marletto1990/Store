/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(['sap/apf/cloudFoundry/utils'],function(U){'use strict';var A=function(i){var m=i.instances.messageHandler;var c=i.instances.coreApi;var a=i.manifests.manifest;var d=a["sap.app"].dataSources;var b=d&&d["apf.runtime.analysisPaths"]&&d["apf.runtime.analysisPaths"].uri;var e={"Content-Type":"application/json; charset=utf-8"};var r=U.resolveUri.bind(this,i.instances.coreApi);this.openPath=function(n,o){var u=r(b+"/"+n+"?$select=AnalysisPathName,SerializedAnalysisPath");l({method:"GET",url:u,dataType:"json",success:function(p){var q={AnalysisPathName:p.analysisPath.analysisPathName,SerializedAnalysisPath:JSON.parse(p.analysisPath.serializedAnalysisPath)};o({path:q,status:"successful"},g());},error:function(p,t,q,M){var s=f(p,"5252",[n],M,m);m.putMessage(s);},headers:e});};this.createPath=function(n,o,s){var p=j();if(p===undefined){o({status:"failed"},undefined,m.createMessageObject({code:5075}));return;}var q=k(s);var t={analysisPathName:n,analyticalConfiguration:p,structuredAnalysisPath:JSON.stringify(q),serializedAnalysisPath:JSON.stringify(s)};l({method:"POST",url:r(b),data:JSON.stringify(t),dataType:"json",success:function(u){o({AnalysisPath:u.analysisPath,status:"successful"},g());},error:function(u,v,w,M){var x=h(u,M,m);o({status:"failed"},undefined,x);},headers:e});};this.modifyPath=function(n,o,p,s){var q=k(s);var t={analysisPathName:o,structuredAnalysisPath:JSON.stringify(q),serializedAnalysisPath:JSON.stringify(s)};l({method:"PUT",url:r(b+"/"+n),data:JSON.stringify(t),dataType:"json",success:function(){p({AnalysisPath:n,status:"successful"},g());},error:function(u,v,w,M){var x=h(u,M,m);p({status:"failed"},undefined,x);},headers:e});};this.deletePath=function(n,o){l({method:"DELETE",url:r(b+"/"+n),success:function(){o({status:"successful"},g());},error:function(p,t,q,M){var s=h(p,M,m);o({status:"failed"},undefined,s);}});};this.readPaths=function(n){function t(p){var q=[];if(p.analysisPaths!==null){p.analysisPaths.forEach(function(s){q.push({AnalysisPath:s.analysisPath,AnalysisPathName:s.analysisPathName,LastChangeUTCDateTime:s.lastChangeUtcDateTime,StructuredAnalysisPath:JSON.parse(s.structuredAnalysisPath)});});}return q;}var o=j();if(o===undefined){n({status:"failed"},undefined,m.createMessageObject({code:5075}));return;}var u=r(b+"?$select=AnalysisPath,AnalysisPathName,LastChangeUtcDateTime,StructuredAnalysisPath&$filter=(AnalyticalConfiguration%20eq%20'"+o+"')");l({url:u,dataType:"json",success:function(p){var q=t(p);n({paths:q,status:"successful"},g());},error:function(p,q,s,M){var v=h(p,M,m);n({status:"failed"},undefined,v);},headers:e});};function g(){return undefined;}function f(n,o,p,q,m){var s=m.createMessageObject({code:o,aParameters:p});var t=h(n,q,m);s.setPrevious(t);return s;}function h(n,p,m){var t=m.createMessageObject({code:"5214",aParameters:[n.status,n.statusText]});if(p){t.setPrevious(p);}return t;}function j(){var n=c.getStartParameterFacade().getAnalyticalConfigurationId();return n&&n.configurationId;}function k(s){var n=[];var o=s.path.steps;o.forEach(function(p){n.push({stepId:p.stepId,selectedRepresentationId:p.binding.selectedRepresentationId});});return{steps:n,indexOfActiveStep:s.path.indicesOfActiveSteps[0]};}function l(n){i.instances.ajaxHandler.send(n);}};sap.apf=sap.apf||{};sap.apf.cloudFoundry=sap.apf.cloudFoundry||{};sap.apf.cloudFoundry.AnalysisPathProxy=A;return A;},true);
