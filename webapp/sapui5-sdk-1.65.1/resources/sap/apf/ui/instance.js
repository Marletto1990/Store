/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2019 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/ui/utils/constants','sap/apf/core/constants','sap/apf/ui/reuse/view/analysisPath.view','sap/apf/ui/reuse/view/carousel.view'],function(u,c,A,C){'use strict';function s(o,f,S){var l=o.getLayoutView();var a=l.byId("subHeader");a.addContent(f);f.addEventDelegate({onAfterRendering:function(){a.setBusy(false);if(f instanceof sap.ui.comp.smartfilterbar.SmartFilterBar){a.setHeight("");a.addStyleClass(S);if(!f.getFilterBarExpanded()||f.getFilters().length===0){f.addStyleClass("smartFilterBar");}else{f.removeStyleClass("smartFilterBar");}}}});}function r(o){o.getLayoutView().byId("subHeader").setBusy(false);}function I(i){i.uiApi=this;var o=i.oCoreApi;var S=i.oStartFilterHandler;var a;var m;var b;var t;var d;var e;var p;var f;var g;var F,h;var j=o.getUriGenerator().getApfLocation();this.oEventCallbacks={};var k;jQuery.sap.includeStyleSheet(j+"resources/css/apfUi.css","apfCss");jQuery.sap.includeStyleSheet(j+"resources/css/apfPrint.css","printCss");jQuery("#printCss").attr("media","print");this.getAddAnalysisStepButton=function(){return this.getAnalysisPath().getCarousel().addButton;};this.getAnalysisPath=function(){if(a===undefined){a=sap.ui.view({viewName:"sap.apf.ui.reuse.view.analysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return a;};this.getNotificationBar=function(){if(m===undefined){m=sap.ui.view({viewName:"sap.apf.ui.reuse.view.messageHandler",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return m;};this.getStepContainer=function(){if(b===undefined){b=sap.ui.view({viewName:"sap.apf.ui.reuse.view.stepContainer",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return b;};this.getToolbar=function(){if(t===undefined){t=sap.ui.view({viewName:"sap.apf.ui.reuse.view.toolbar",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return t;};this.getCarousel=function(){if(i&&i.functions&&i.functions.getCarousel){d=i.functions.getCarousel();}if(d===undefined){d=sap.ui.view({viewName:"sap.apf.ui.reuse.view.carousel",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return d;};this.getStepGallery=function(){if(e===undefined){e=sap.ui.view({type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.apf.ui.reuse.view.stepGallery",viewData:i,async:true});}return e;};this.getPathGallery=function(){if(p===undefined){p=sap.ui.view({viewName:"sap.apf.ui.reuse.view.pathGallery",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return p;};this.getDeleteAnalysisPath=function(){if(f===undefined){f=sap.ui.view({viewName:"sap.apf.ui.reuse.view.deleteAnalysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return f;};this.getLayoutView=function(){if(g===undefined){g=sap.ui.view({viewName:"sap.apf.ui.reuse.view.layout",type:sap.ui.core.mvc.ViewType.XML,viewData:i,async:true});}return g;};this.selectionChanged=function(R){var q;function w(){if(g){g.getController().enableDisableOpenIn();}}q=o.getSteps().indexOf(o.getActiveStep());if(R){this.getAnalysisPath().getController().refresh(0);}else{this.getAnalysisPath().getController().refresh(q+1);}o.updatePath(this.getAnalysisPath().getController().callBackForUpdatePath.bind(this.getAnalysisPath().getController()),function(){w();});};var l=false;this.createApplicationLayout=function(q){var w=this;return new Promise(function(x){if(!l){var y=w.getStepGallery().loaded();var z=w.getToolbar().loaded();var B=w.getPathGallery().loaded();var D=w.getDeleteAnalysisPath().loaded();var E=w.getStepContainer().loaded();var G=Promise.all([y]).then(function(){return w.getCarousel().loaded();});var H=Promise.all([z,G,B,D]).then(function(){return w.getAnalysisPath().loaded();});var J=Promise.all([E,H]).then(function(){return w.getLayoutView().loaded();});J.then(function(){q.addPage(g);l=true;k=q;x(q);});}else{x(k);}});};this.addDetailFooterContent=function(q){this.getLayoutView().getController().addDetailFooterContentLeft(q);};this.addMasterFooterContentRight=function(q){this.getLayoutView().getController().addMasterFooterContentRight(q);};this.setEventCallback=function(E,q){this.oEventCallbacks[E]=q;};this.getEventCallback=function(E){return this.oEventCallbacks[E];};this.getCustomFormatExit=function(){return i.exits;};this.setCustomFormatExit=function(q){var w=this.getCustomFormatExit();w.customFormat=q;};this.drawSmartFilterBar=function(q){var w=this;function x(y){o.getSmartFilterbarDefaultFilterValues().done(function(z){h=sap.ui.view({viewName:"sap.apf.ui.reuse.view.smartFilterBar",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:o,oUiApi:w,oSmartFilterBarConfiguration:y,controlConfiguration:z,parent:w.getLayoutView()},async:true});h.loaded().then(function(V){s(w,V.byId("idAPFSmartFilterBar"),"smartFilterBarContainer");});});}if(q){if(q.entitySet){x(q);}else{o.getMetadata(q.service).done(function(y){q.entitySet=y.getEntitySetByEntityType(q.entityType);delete q.entityType;x(q);});}}else{r(w);}};this.drawFacetFilter=function(q){if(q.length>0){var w=this;F=sap.ui.view({viewName:"sap.apf.ui.reuse.view.facetFilter",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:o,oUiApi:this,aConfiguredFilters:q,oStartFilterHandler:S},async:true});F.loaded().then(function(V){s(w,V.byId("idAPFFacetFilter"));});}else{r(this);}};this.contextChanged=function(R){var q=this.getEventCallback(c.eventTypes.contextChanged);if(typeof q==="function"){q();}};this.getFacetFilterForPrint=function(){if(F){return F.byId("idAPFFacetFilter");}};this.getSmartFilterForPrint=function(){if(h){return h.byId("idAPFSmartFilterBar");}};this.handleStartup=function(q){var w=this;var x=jQuery.Deferred();o.getSmartFilterBarConfigurationAsPromise().done(function(y){if(y){w.drawSmartFilterBar(y);}q.done(function(z){var B=S.getStartFilters();B.done(function(D){w.contextChanged();if(!y){w.drawFacetFilter(D);}if(z.navigationMode==="backward"){w.getAnalysisPath().getController().isBackNavigation=true;o.updatePath(w.getAnalysisPath().getController().callBackForUpdatePath.bind(w.getAnalysisPath().getController()));w.getAnalysisPath().getController().setPathTitle();}if(z.navigationMode==="forward"){if(o.getStartParameterFacade().getSteps()){var E=o.getStartParameterFacade().getSteps()[0].stepId;var G=o.getStartParameterFacade().getSteps()[0].representationId;var H=w.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(w.getAnalysisPath().getController());o.createFirstStep(E,G,H);}}w.getNotificationBar().loaded().then(function(M){w.getLayoutView().byId("applicationPage").addContent(M);var J=M.getController().showMessage;o.setCallbackForMessageHandling(J.bind(M.getController()));x.resolve();});});});});return x.promise();};this.destroy=function(){F=undefined;h=undefined;if(a){this.getAnalysisPath().getCarousel().dndBox=undefined;var q=this.getAnalysisPath().getToolbar().getController();n(q.saveDialog);n(q.newOpenDialog);n(q.newDialog);n(q.confirmDialog);n(q.errorMsgDialog);n(q.noPathAddedDialog);if(q.deleteAnalysisPath!==undefined){n(q.deleteAnalysisPath.getController().oDialog);}if(q.pathGallery!==undefined){n(q.pathGallery.getController().oDialog);}var w=this.getAnalysisPath().getCarousel().getStepGallery().getController();n(w.oHierchicalSelectDialog);}if(b){var x=this.getStepContainer().getController();n(x.selectionDisplayDialog);v(this);}};function n(q){if(q!==undefined){if(q instanceof sap.m.ViewSettingsDialog){q.destroy();}else if(q.isOpen()){q.close();}}}function v(q){var w=false;var x=false;var y;if(q.getStepContainer().getViewData().oCoreApi.getActiveStep()!==undefined){w=true;}if(w){y=q.getStepContainer().getViewData().oCoreApi.getActiveStep().getSelectedRepresentation();if(y!==undefined){x=true;}}if(x){if(y.type!==u.representationTypes.TABLE_REPRESENTATION){if(y.toggleInstance!==undefined){n(y.toggleInstance.viewSettingsDialog);}}else{n(y.viewSettingsDialog);}}}}sap.apf.ui.Instance=I;return I;},true);
