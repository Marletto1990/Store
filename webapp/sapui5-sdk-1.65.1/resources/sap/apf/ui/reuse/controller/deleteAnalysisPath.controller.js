/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(['sap/m/Dialog','sap/m/DialogType','sap/m/Text','sap/m/Button','sap/ui/model/json/JSONModel','sap/ui/core/mvc/Controller'],function(D,a,T,B,J,b){"use strict";return b.extend("sap.apf.ui.reuse.controller.deleteAnalysisPath",{onInit:function(){this.oCoreApi=this.getView().getViewData().oInject.oCoreApi;this.oUiApi=this.getView().getViewData().oInject.uiApi;this.oSerializationMediator=this.getView().getViewData().oInject.oSerializationMediator;},openPathGallery:function(){var p=new J();p.setData(this.getView().getViewData().jsonData);this.oDialog=this.getView().getContent()[0];this.oDialog.getContent()[0].setModel(p);this.oDialog.setInitialFocus(this.oDialog);this.oDialog.open();},handleDeleteOfDialog:function(e){var p=e.getParameter("listItem").getProperty('title');var l={item:e.getParameter("listItem"),list:this.getView().getContent()[0].getContent()[0],guid:this.getGuidForPath(p,this.getView().getViewData().jsonData.GalleryElements),sPathName:p};this.openConfirmDelDialog(l);},getGuidForPath:function(p,v){var i;for(i=0;i<v.length;i++){var d=v[i];if(d.AnalysisPathName===p){return d.guid;}}},deleteSavedPath:function(p,i){var s=this;var g=i.guid;var c=p;var m;var d=s.oUiApi.getAnalysisPath().oSavedPathName.getTitle();s.oSerializationMediator.deletePath(g,function(r,e,f){if(f===undefined&&(typeof r==="object")){i.list.removeItem(i.item);i.list.rerender();s.oCoreApi.readPaths(function(r,e,f){if(f===undefined&&(typeof r==="object")){var n=r.paths.length;if(n===0){jQuery(".pathText").removeClass("pathTextDontShow");jQuery(".pathText").addClass("pathTextShow");}}else{m=s.oCoreApi.createMessageObject({code:"6005",aParameters:[c]});m.setPrevious(f);s.oCoreApi.putMessage(m);}});}else{m=s.oCoreApi.createMessageObject({code:"6009",aParameters:[c]});m.setPrevious(f);s.oCoreApi.putMessage(m);}});if(s.oCoreApi.isDirty()){d=d.substring(1);}if(d===c){s.oUiApi.getAnalysisPath().getToolbar().getController().resetAnalysisPath();}},openConfirmDelDialog:function(l){var s=this;var p=l.sPathName;var t=new T().addStyleClass("textStyle");t.setText(s.oCoreApi.getTextNotHtmlEncoded("do-you-want-to-delete-analysis-path",["'"+p+"'"]));s.delConfirmDialog=new D({type:a.Standard,title:s.oCoreApi.getTextNotHtmlEncoded("delPath"),content:t,beginButton:new B({text:s.oCoreApi.getTextNotHtmlEncoded("yes"),press:function(){s.deleteSavedPath(p,l);s.delConfirmDialog.close();}}),endButton:new B({text:s.oCoreApi.getTextNotHtmlEncoded("no"),press:function(){s.delConfirmDialog.close();}}),afterClose:function(){s.oUiApi.getLayoutView().setBusy(false);s.delConfirmDialog.destroy();}});if(sap.ui.Device.system.desktop){s.delConfirmDialog.addStyleClass("sapUiSizeCompact");}s.delConfirmDialog.open();}});});
