/* (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.utils.printModel");jQuery.sap.require("sap.apf.ui.utils.formatter");jQuery.sap.require("sap.viz.ui5.types.legend.Common");(function(){"use strict";sap.apf.ui.utils.PrintModel=function(i){this.oUiApi=i.uiApi;this.oCoreApi=i.oCoreApi;this.oFilterIdHandler=i.oFilterIdHandler;};sap.apf.ui.utils.PrintModel.prototype.constructor=sap.apf.ui.utils.PrintModel;function g(p,m,h,o,v,i){var F=new sap.apf.ui.utils.formatter({getEventCallback:p.oUiApi.getEventCallback.bind(p.oUiApi),getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded,getExits:p.oUiApi.getCustomFormatExit()},m);var j=F.getFormattedValue(h,v);var k=F.getFormattedValue(h,i);var l=p.oCoreApi.getTextNotHtmlEncoded(o,[j,k]);return l;}function _(p){var s=p.oUiApi.getSmartFilterForPrint();var F=[];if(s!==undefined&&s!==null){var S=s.getFilterData();var h=s.getAnalyticalParameters();if(h&&h.length>0){h.forEach(function(k){var v=S[k.fieldName];var l=k.fieldNameOData;p.oCoreApi.getMetadataFacade().getProperty(l).done(function(m){F.push({sFilterName:l,sFilterValue:g(p,m,l,"EQ",v)});});});}var u=s.getFilters();if(u.length>0){var o=sap.apf.core.utils.Filter.transformUI5FilterToInternal(p.oCoreApi.getMessageHandler(),u[0]);for(var i in S){var t="";var j=o.getFilterTermsForProperty(i);if(j.length>0){p.oCoreApi.getMetadataFacade().getProperty(i).done(function(m){for(var v=0;v<j.length;v++){t+=g(p,m,i,j[v]['operator'],j[v]['value'],j[v]['highValue']);if(v!==j.length-1){t+=", ";}}F.push({sFilterName:i,sFilterValue:t});});}}}}return F;}function a(p){var n,F="",s;var o,h,i=[],S=[],k=[];o=p.oUiApi.getFacetFilterForPrint();if(o){h=o.getLists();for(n=0;n<h.length;n++){F=h[n].getTitle();k=h[n].getSelectedItems();if(k.length>0){S=b(k);if(F!==undefined&&F!==null){s="";for(var j=0;j<S.length;j++){if(j!==S.length-1){s+=S[j]+", ";}else{s+=S[j];}}i.push({sFilterName:F,sFilterValue:s});}}else{i.push({sFilterName:F,sFilterValue:p.oCoreApi.getTextNotHtmlEncoded("noSelectionInFilter")});}}}return i;}function b(s){var S=[];s.forEach(function(i){S.push(i.getText());});return S;}function c(p){var A=p.oFilterIdHandler.getAllInternalIds();var o,h=[],i;if(A.length>0){for(i=0;i<A.length;i++){o=p.oFilterIdHandler.get(A[i]).getExpressions();h.push(o[0]);}}return h;}function d(p,A){var h=[],i,j,F="",s,o,P;var k=[];for(i=0;i<A.length;i++){for(j=0;j<A[i].length;j++){p.oCoreApi.getMetadataFacade().getProperty(A[i][j].name).done(function(m){P=m;F="";k=[];F=m.label;o=new sap.apf.ui.utils.formatter({getEventCallback:p.oUiApi.getEventCallback.bind(p.oUiApi),getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded,getExits:p.oUiApi.getCustomFormatExit()},m);});k.push(o.getFormattedValue(P.name,A[i][j].value));if(F!==undefined&&F!==null){s="";for(var j=0;j<k.length;j++){if(j!==k.length-1){s+=k[j]+", ";}else{s+=k[j];}}h.push({sFilterName:F,sFilterValue:s});}}}return h;}function e(p){var h=p.oUiApi.getEventCallback(sap.apf.core.constants.eventTypes.printTriggered);var A=d(p,c(p));if(h!==undefined){var i={getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded};A=h.apply(i,c(p));}return A;}function f(p){var F,h,i;var j=a(p);h=_(p);F=e(p);i=F.concat(h,j);return i;}sap.apf.ui.utils.PrintModel.prototype.getFiltersToPrint=function(){var p=this;var F=f(p);return F;};sap.apf.ui.utils.PrintModel.prototype.getHeaderForFirstPage=function(){return this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();};sap.apf.ui.utils.PrintModel.prototype.getApplicationName=function(){var m;var A=this.applicationConfig.appName;if(!A){m=this.oCoreApi.createMessageObject({code:"6003",aParameters:["sAppName"]});this.oCoreApi.putMessage(m);}return A;};sap.apf.ui.utils.PrintModel.prototype.setApplicationConfig=function(h){this.applicationConfig=h;};sap.apf.ui.utils.PrintModel.prototype.getRepresentationForPrint=function(s){var p;var I;var i;var o;var h;var S=this.oCoreApi.getTextNotHtmlEncoded(s.title);var j=s.getSelectedRepresentation();var k=j.bIsAlternateView?j.toggleInstance:j;if(k&&k.titleControl&&k.titleControl.oParent){o=k.titleControl.oParent.getItems();if(o&&o.length>1){for(i=0;i<o.length;i++){if(o[i].getMetadata()._sClassName==="sap.m.HBox"){h=o[i];h.setVisible(false);}}}}p=k.getPrintContent(S);return p.oRepresentation;};})();
