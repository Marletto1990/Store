/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved
 */
(function(){var D=jQuery.sap.log.isLoggable(jQuery.sap.log.Level.DEBUG),C="sap.ca.scfld.md.app.CommonHeaderFooterHelper";jQuery.sap.declare("sap.ca.scfld.md.app.CommonHeaderFooterHelper");jQuery.sap.require("sap.ushell.ui.footerbar.JamShareButton");jQuery.sap.require("sap.ushell.ui.footerbar.JamDiscussButton");jQuery.sap.require("sap.ushell.ui.footerbar.AddBookmarkButton");jQuery.sap.require("sap.ca.scfld.md.app.ButtonListHelper");jQuery.sap.require("sap.ushell.services.AppConfiguration");jQuery.sap.require("sap.ca.scfld.md.app.BarOverflow");jQuery.sap.require("sap.ca.scfld.md.app.BarOverflowLayoutData");function r(b,t){var e,f=t.focusInfo,o=b.oOverflowButton;if(f){if(f.area==="share"){f.area="right";f.pos=1000;f.controlInfo={icon:"sap-icon://action",text:"",tooltip:t.shareText};}e=b.findFocusedElement(f,o);if(e){setTimeout(function(){if(!jQuery(e.$()[0]).is(":visible")){e=o;}if(e){e.focus();if(D){jQuery.sap.log.debug("Restored focus on "+e.getId(),C);}}t.focusInfo=undefined;},100);}else{t.focusInfo=undefined;}}}sap.ui.base.Object.extend("sap.ca.scfld.md.app.CommonHeaderFooterHelper",{constructor:function(a,d,A){this.oAppImp=a;this.detailHeaderFooterRules=d;this.bAutomaticOverflow=!!A;},startBuild:function(c,O,s,k){var a=c._oControlStore;c._oHeaderFooterOptions=O;var p=c.getPage();if(a){if(!this.focusInfo){this.focusInfo=a.oButtonListHelper.getFocusInfo(a.oShareSheet);if(D){jQuery.sap.log.debug("Store focus information for "+c.getMetadata().getName(),JSON.stringify(this.focusInfo),C);}}c._oControlStore.oButtonListHelper.startBuild(k);}else{c._oControlStore={};if(s){jQuery.extend(c._oControlStore,s);}c._oControlStore.oButtonListHelper=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,20,c._oControlStore.bAllDisabled,this.bAutomaticOverflow,this.createId(c,"scfld_OVERFLOW"));this.oAppImp.registerExitModule(function(){var K,o;if(c._oControlStore){c._oControlStore.oButtonListHelper.destroy();delete c._oControlStore.oButtonListHelper;for(K in c._oControlStore){o=c._oControlStore[K];if(o&&typeof o.destroy==="function"){o.destroy();}delete c._oControlStore[K];}delete c._oControlStore;}});var f=p.getFooter();if(f&&f.destroy){f.destroy();}p.setFooter(c._oControlStore.oButtonListHelper.oBar);}return p;},endBuild:function(c){var b=c._oControlStore.oButtonListHelper;b.endBuild();r(b,this);},defineFooterRight:function(c,p,f,I,b){var h=false,s=this.isUsingStableIds(),B;if(this.bAutomaticOverflow){f=10000;}if(c._oHeaderFooterOptions.oEditBtn){B={};jQuery.extend(B,c._oHeaderFooterOptions.oEditBtn);if(s){this.addIds(B,c._oHeaderFooterOptions.oEditBtn.sId,c,"scfld_EDIT");}B.style=sap.m.ButtonType.Emphasized;c._oControlStore.oButtonListHelper.ensureButton(B,"b",f);h=true;}else{if(c._oHeaderFooterOptions.oPositiveAction){B={};jQuery.extend(B,c._oHeaderFooterOptions.oPositiveAction);if(s){this.addIds(B,c._oHeaderFooterOptions.oPositiveAction.sId,c,"scfld_POSITIVE");}B.style=sap.m.ButtonType.Accept;c._oControlStore.oButtonListHelper.ensureButton(B,"b",f);h=true;}if(c._oHeaderFooterOptions.oNegativeAction){B={};jQuery.extend(B,c._oHeaderFooterOptions.oNegativeAction);if(s){this.addIds(B,c._oHeaderFooterOptions.oNegativeAction.sId,c,"scfld_NEGATIVE");}B.style=sap.m.ButtonType.Reject;c._oControlStore.oButtonListHelper.ensureButton(B,"b",f);h=true;}}if(c._oHeaderFooterOptions.buttonList){for(var i=0;i<c._oHeaderFooterOptions.buttonList.length;i++){B={};jQuery.extend(B,c._oHeaderFooterOptions.buttonList[i]);if(s){this.addIds(B,c._oHeaderFooterOptions.buttonList[i].sId,c,undefined);}B.style=sap.m.ButtonType.Default;c._oControlStore.oButtonListHelper.ensureButton(B,"b",f);h=true;}}if(I){var g=this.getGenericButtons(f,c,c._oControlStore.oButtonListHelper);h=h||g.length>0;}if(this.bAutomaticOverflow){c._oControlStore.oButtonListHelper.addOverflowButton();}h=this.defineShareButton(c)||h;return h;},defineShareButton:function(c){var b=this.getShareButtons(c);if(b.length==0){return false;}if(!c._oControlStore.oShareSheet){c._oControlStore.oShareSheet=new sap.m.ActionSheet();c._oControlStore.oShareSheet.setShowCancelButton(true);c._oControlStore.oShareSheet.setPlacement(sap.m.PlacementType.Top);}else{c._oControlStore.oShareSheet.removeAllButtons();}this.shareText=this.oAppImp.UilibI18nModel.getResourceBundle().getText("SHARE");var B={sIcon:"sap-icon://action",sTooltip:this.shareText,onBtnPressed:function(e){if(c._oHeaderFooterOptions.oJamOptions){if(c._oHeaderFooterOptions.oJamOptions.fGetShareSettings){var s=c._oHeaderFooterOptions.oJamOptions.fGetShareSettings();if(s){c._oControlStore.oJamShareButton.setJamData(s);}}if(c._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings){var d=c._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings();if(d){c._oControlStore.oJamDiscussButton.setJamData(d);}}}c._oControlStore.oShareSheet.openBy(e.getSource());}};if(this.isUsingStableIds()){this.addIds(B,undefined,c,"scfld_SHARE");}c._oControlStore.oButtonListHelper.ensureButton(B,"b");for(var i=0;i<b.length;i++){c._oControlStore.oShareSheet.addButton(b[i]);}return true;},hasShareButtons:function(c){return c.isMainScreen()||!!(c._oHeaderFooterOptions.oEmailSettings||(c._oHeaderFooterOptions.oJamOptions&&(c._oHeaderFooterOptions.oJamOptions.oShareSettings||c._oHeaderFooterOptions.oJamOptions.fGetShareSettings||c._oHeaderFooterOptions.oJamOptions.oDiscussSettings||c._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings))||c._oHeaderFooterOptions.oAddBookmarkSettings||(c._oHeaderFooterOptions.additionalShareButtonList&&c._oHeaderFooterOptions.additionalShareButtonList.length>0));},getShareButtons:function(c){var R=[];var e=this.getEmailButton(c);var j=this.getJamShareButton(c);var J=this.getJamDiscussButton(c);var b=this.getBookmarkButton(c);if(e){R.push(e);}if(j){R.push(j);}if(J){R.push(J);}if(b){R.push(b);}if(c._oHeaderFooterOptions.additionalShareButtonList){var a=this.getAdditionalShareButtons(c);R=R.concat(a);}return R;},getEmailButton:function(c){var b;if(!c._oHeaderFooterOptions.oEmailSettings){return null;}if(!c._oControlStore.oEmailButton){c._oControlStore.oEmailButton=new sap.m.Button({id:this.createId(c,"scfld_MAIL")});c._oControlStore.oEmailButton.setIcon("sap-icon://email");c._oControlStore.oEmailButton.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText("SEND_EMAIL"));c._oControlStore.oEmailButton.attachPress(function(){if(c._oHeaderFooterOptions.oEmailSettings.fGetMailBody){b=c._oHeaderFooterOptions.oEmailSettings.fGetMailBody();}else{b=null;}sap.m.URLHelper.triggerEmail(c._oHeaderFooterOptions.oEmailSettings.sRecepient,c._oHeaderFooterOptions.oEmailSettings.sSubject,b);});}this.supportEnablement(c,c._oControlStore.oEmailButton,c._oHeaderFooterOptions.oEmailSettings);return c._oControlStore.oEmailButton;},getJamShareButton:function(c){if(!c._oHeaderFooterOptions.oJamOptions||!(c._oHeaderFooterOptions.oJamOptions.oShareSettings||c._oHeaderFooterOptions.oJamOptions.fGetShareSettings)){return null;}if(!c._oControlStore.oJamShareButton){c._oControlStore.oJamShareButton=new sap.ushell.ui.footerbar.JamShareButton({id:this.createId(c,"scfld_JAMSHARE")});}if(c._oHeaderFooterOptions.oJamOptions.oShareSettings){c._oControlStore.oJamShareButton.setJamData(c._oHeaderFooterOptions.oJamOptions.oShareSettings);this.supportEnablement(c,c._oControlStore.oJamShareButton,c._oHeaderFooterOptions.oJamOptions.oShareSettings);}return c._oControlStore.oJamShareButton;},getJamDiscussButton:function(c){if(!c._oHeaderFooterOptions.oJamOptions||!(c._oHeaderFooterOptions.oJamOptions.oDiscussSettings||c._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings)){return null;}if(!c._oControlStore.oJamDiscussButton){c._oControlStore.oJamDiscussButton=new sap.ushell.ui.footerbar.JamDiscussButton({id:this.createId(c,"scfld_JAMDISCUSS")});}if(c._oHeaderFooterOptions.oJamOptions.oDiscussSettings){c._oControlStore.oJamDiscussButton.setJamData(c._oHeaderFooterOptions.oJamOptions.oDiscussSettings);this.supportEnablement(c,c._oControlStore.oJamDiscussButton,c._oHeaderFooterOptions.oJamOptions.oDiscussSettings);}return c._oControlStore.oJamDiscussButton;},getBookmarkButton:function(c){if(c._oHeaderFooterOptions.bSuppressBookmarkButton||(!c._oHeaderFooterOptions.oAddBookmarkSettings&&!c.isMainScreen())){return null;}if(!c._oControlStore.oBookmarkButton){c._oControlStore.oBookmarkButton=new sap.ushell.ui.footerbar.AddBookmarkButton({id:this.createId(c,"scfld_ADDBOOKMARK")});}var a={url:document.URL,title:c._oControlStore.oTitle.getText()};jQuery.extend(a,c._oHeaderFooterOptions.oAddBookmarkSettings||{});c._oControlStore.oBookmarkButton.setAppData(a);this.supportEnablement(c,c._oControlStore.oBookmarkButton,c._oHeaderFooterOptions.oAddBookmarkSettings||{});return c._oControlStore.oBookmarkButton;},supportEnablement:function(c,b,s){b.setEnabled(!s.bDisabled);if(s.sId){c._oControlStore.oButtonListHelper.mButtons[s.sId]=b;}},getAdditionalShareButtons:function(c){var R=[];if(!c._oControlStore.shareButtons){c._oControlStore.shareButtons=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,1);c._oControlStore.oButtonListHelper.addButtonListHelper(c._oControlStore.shareButtons);}for(var i=0;i<c._oHeaderFooterOptions.additionalShareButtonList.length;i++){var b={};jQuery.extend(b,c._oHeaderFooterOptions.additionalShareButtonList[i]);if(this.isUsingStableIds()){this.addIds(b,c._oHeaderFooterOptions.additionalShareButtonList[i].sId,c,undefined);}var B=c._oControlStore.shareButtons.ensureButton(b,"b");R.push(B);}return R;},getFooterRightCount:function(c,t){var l;switch(t){case"XL":l=this.detailHeaderFooterRules.maxBtnCountXL;break;case"L":l=this.detailHeaderFooterRules.maxBtnCountL;break;case"M":l=this.detailHeaderFooterRules.maxBtnCountM;break;case"S":l=this.detailHeaderFooterRules.maxBtnCountS;break;default:l=this.detailHeaderFooterRules.maxBtnCountXL;}return l;},getActionsCount:function(c,s){var i=0;if(c._oHeaderFooterOptions.buttonList){i=c._oHeaderFooterOptions.buttonList.length;}if(c._oHeaderFooterOptions.oEditBtn){if(!s){i++;}}else{if(c._oHeaderFooterOptions.oPositiveAction){i++;}if(c._oHeaderFooterOptions.oNegativeAction){i++;}}return i;},createSettingsButton:function(c){var R;if(c._oControlStore.oSettingsButton){R=false;}else{R=true;}if(c._oHeaderFooterOptions.aAdditionalSettingButtons){if(!c._oControlStore.oSettingsButtonListHelper){c._oControlStore.oSettingsButtonListHelper=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,0);c._oControlStore.oButtonListHelper.addButtonListHelper(c._oControlStore.oSettingsButtonListHelper);}var b=[];for(var i=0;i<c._oHeaderFooterOptions.aAdditionalSettingButtons.length;i++){var B={};jQuery.extend(B,c._oHeaderFooterOptions.aAdditionalSettingButtons[i]);delete B.sIcon;var o=c._oControlStore.oSettingsButtonListHelper.ensureButton(B,"b");o.setWidth("100%");b.push(o);}sap.ushell.services.AppConfiguration.addApplicationSettingsButtons(b);}return R;},getGenericButtons:function(f,c,b){var R=[];if(c._oHeaderFooterOptions.oSortOptions){R.push(this.addSortButton(f,c,b));}if(c._oHeaderFooterOptions.oFilterOptions){R.push(this.addFilterButton(f,c,b));}if(c._oHeaderFooterOptions.oGroupOptions){R.push(this.addGroupButton(f,c,b));}return R;},addFilterButton:function(f,c,b){var B=this.oAppImp.UilibI18nModel.getResourceBundle().getText("FILTER"),o={bDisabled:c._oHeaderFooterOptions.oFilterOptions.bDisabled,sIcon:"sap-icon://filter",sBtnTxt:B,sTooltip:c._oHeaderFooterOptions.oFilterOptions.sTooltip||B},t;this.addIds(o,c._oHeaderFooterOptions.oFilterOptions.sId,c,"scfld_FILTER");if(c._oHeaderFooterOptions.oFilterOptions.aFilterItems){o.onChange=jQuery.proxy(function(k){b._updateCurrentSelection("filter",k);c._oHeaderFooterOptions.oFilterOptions.onFilterSelected(k);},this);o.aItems=c._oHeaderFooterOptions.oFilterOptions.aFilterItems;o.sSelectedItemKey=b._getCurrentSelection("filter",c._oHeaderFooterOptions.oFilterOptions.sSelectedItemKey);t="s";}else{o.onBtnPressed=jQuery.proxy(function(e){c._oHeaderFooterOptions.oFilterOptions.onFilterPressed(e);},this);t="b";}return b.ensureButton(o,t,f);},addSortButton:function(f,c,b){var B=this.oAppImp.UilibI18nModel.getResourceBundle().getText("SORT"),o={bDisabled:c._oHeaderFooterOptions.oSortOptions.bDisabled,sIcon:"sap-icon://sort",sBtnTxt:B,sTooltip:c._oHeaderFooterOptions.oSortOptions.sTooltip||B},t;this.addIds(o,c._oHeaderFooterOptions.oSortOptions.sId,c,"scfld_SORT");if(c._oHeaderFooterOptions.oSortOptions.aSortItems){o.onChange=jQuery.proxy(function(k){b._updateCurrentSelection("sort",k);c._oHeaderFooterOptions.oSortOptions.onSortSelected(k);},this);o.aItems=c._oHeaderFooterOptions.oSortOptions.aSortItems;o.sSelectedItemKey=b._getCurrentSelection("sort",c._oHeaderFooterOptions.oSortOptions.sSelectedItemKey);t="s";}else{o.onBtnPressed=jQuery.proxy(function(e){c._oHeaderFooterOptions.oSortOptions.onSortPressed(e);},this);t="b";}return b.ensureButton(o,t,f);},addGroupButton:function(f,c,b){var B=this.oAppImp.UilibI18nModel.getResourceBundle().getText("GROUP"),o={bDisabled:c._oHeaderFooterOptions.oGroupOptions.bDisabled,sIcon:"sap-icon://group-2",sBtnTxt:B,sTooltip:c._oHeaderFooterOptions.oGroupOptions.sTooltip||B},t;this.addIds(o,c._oHeaderFooterOptions.oGroupOptions.sId,c,"scfld_GROUP");if(c._oHeaderFooterOptions.oGroupOptions.aGroupItems){o.onChange=jQuery.proxy(function(k){b._updateCurrentSelection("group",k);c._oHeaderFooterOptions.oGroupOptions.onGroupSelected(k);},this);o.aItems=c._oHeaderFooterOptions.oGroupOptions.aGroupItems;o.sSelectedItemKey=b._getCurrentSelection("group",c._oHeaderFooterOptions.oGroupOptions.sSelectedItemKey);t="s";}else{o.onBtnPressed=jQuery.proxy(function(e){c._oHeaderFooterOptions.oGroupOptions.onGroupPressed(e);},this);t="b";}return b.ensureButton(o,t,f);},ensureHeader:function(c,p,g,s,t){if(!c._oControlStore.oHeaderBar){c._oControlStore.oHeaderBar=new sap.m.Bar();t=this.isUsingStableIds()&&t?this.createId(c,t):undefined;c._oControlStore.oTitle=new sap.m.Title(t,{level:sap.ui.core.TitleLevel.H2});c._oControlStore.oHeaderBar.addContentMiddle(c._oControlStore.oTitle);var o=p.getCustomHeader();if(o&&o.destroy){o.destroy();}p.setCustomHeader(c._oControlStore.oHeaderBar);}this.setBackButton(c,c._oControlStore.oHeaderBar,g,s);},setAppHeaderBtn:function(c,b){if(!c._oControlStore.oHeaderBar){return;}if(!c._oControlStore.oHeaderBtn){if(b.sId){c._oControlStore.oHeaderBtn=new sap.m.Button(b.sId);}else{c._oControlStore.oHeaderBtn=new sap.m.Button();}c._oControlStore.oHeaderBar.addContentRight(c._oControlStore.oHeaderBtn);}var _=c._oControlStore.oHeaderBtn;if(b.sIcon){_.setIcon(b.sIcon);}if(b.onBtnPressed){_.attachPress(b.onBtnPressed);}if(b.sText){_.setText(b.sText);}else if(b.oTextBinding){if(b.oTextBinding.elementPath){if(b.oTextBinding.parameters){_.bindElement(b.oTextBinding.elementPath,b.oTextBinding.parameters);}else{_.bindElement(b.oTextBinding.elementPath);}}if(b.oTextBinding.property){_.bindProperty("text",b.oTextBinding.property);}}else if(this.oAppImp.bIsPhone&&b.i18nPhoneTxt){_.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText(b.i18nPhoneTxt));}else if(b.i18nTxt){_.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText(b.i18nTxt));}},setBackButton:function(c,b,g,s){if(s||(g&&c._oHeaderFooterOptions.onBack===null)){c._oControlStore.fBack=null;}else if(g&&c._oHeaderFooterOptions.onBack==undefined){if(window.history.length==0){c._oControlStore.fBack=null;}else{c._oControlStore.fBack=function(){window.history.back(1);};}}else{c._oControlStore.fBack=c._oHeaderFooterOptions.onBack;}if(c._oControlStore.oBackButton){c._oControlStore.oBackButton.setVisible(!!c._oControlStore.fBack);}else if(c._oControlStore.fBack){c._oControlStore.oBackButton=new sap.m.Button({id:this.createId(c,"scfld_BACK")});c._oControlStore.oBackButton.setIcon("sap-icon://nav-back");c._oControlStore.oBackButton.setTooltip(this.oAppImp.UilibI18nModel.getResourceBundle().getText("BACK"));c._oControlStore.oBackButton.attachPress(function(e){c._oControlStore.fBack(e);});b.addContentLeft(c._oControlStore.oBackButton);}},getGenericCount:function(c){var R=0;if(c._oHeaderFooterOptions.oSortOptions){R++;}if(c._oHeaderFooterOptions.oFilterOptions){R++;}if(c._oHeaderFooterOptions.oGroupOptions){R++;}return R;},addIds:function(b,a,c,d){var B=sap.ui.core.ID.isValid(a)?a:d;delete b.sControlId;delete b.sId;if(this.isUsingStableIds()){b.sControlId=this.createId(c,B);b.sId=a||d;}else{b.sId=a;}},createId:function(c,i){if(this.isUsingStableIds()&&i&&sap.ui.core.ID.isValid(i)){return c.getView().createId(i);}return undefined;},isUsingStableIds:function(){return this.oAppImp.oConfiguration&&this.oAppImp.oConfiguration.isUsingStableIds&&this.oAppImp.oConfiguration.isUsingStableIds();}});sap.ca.scfld.md.app.CommonHeaderFooterHelper.getPageFromController=function(c){return c.getView().getContent()[0];};})();
